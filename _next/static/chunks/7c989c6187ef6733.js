(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,85440,(e,t,a)=>{t.exports=e.r(1893)},31713,e=>{"use strict";var t=e.i(63634),a=e.i(63410),s=e.i(2942);function l(){let{locale:e,setLocale:a}=(0,s.useI18n)();return(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("button",{type:"button",onClick:()=>a("ja"),className:`px-3 py-1.5 rounded transition-colors text-sm font-bold ${"ja"===e?"bg-blue-600 text-white":"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}`,children:"æ—¥æœ¬èªž"}),(0,t.jsx)("button",{type:"button",onClick:()=>a("en"),className:`px-3 py-1.5 rounded transition-colors text-sm font-bold ${"en"===e?"bg-blue-600 text-white":"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}`,children:"English"})]})}var n=e.i(85440);let r={I:1,O:2,T:3,S:4,Z:5,J:6,L:7},o={0:null,1:"I",2:"O",3:"T",4:"S",5:"Z",6:"J",7:"L"},i={I:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]],O:[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]],T:[[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]],S:[[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]],Z:[[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]],J:[[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,0,0,0],[1,1,1,0],[0,0,0,0]],[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]]],L:[[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]]]},c={I:i.I[0],O:i.O[0],T:i.T[0],S:i.S[0],Z:i.Z[0],J:i.J[0],L:i.L[0]};function d(e,t){return"O"===e?0:"I"===e||"S"===e||"Z"===e?t%2:t}function m(e){return"empty"===e?0:r[e]}function u(e){return 0===e?"empty":o[e]||"empty"}let x=["I","O","T","S","Z","J","L"],h={I:0,O:1,T:2,S:3,Z:4,J:5,L:6},g=["I","O","T","S","Z","J","L"];function p(e){return{verticalSplitGroups:e>>13&7,complexPlacements:e>>10&7,sonicDropReachable:(2&e)!=0,singleDropReachable:(1&e)!=0}}function b(e){let t=e.map(e=>h[e]);return 2401*t[0]+343*t[1]+49*t[2]+7*t[3]+t[4]}class f{buffer=null;indexTable=null;dataRegion=null;async load(e="/precomputed-patterns.pcdb"){let t;if("undefined"!=typeof Deno&&Deno.readFile){let a=e;if(e.startsWith("/")){let t=e.replace(/^\/k-trainer/,"");a=`./public${t}`}t=(await Deno.readFile(a)).buffer}else{let a="/k-trainer",s=e;e.startsWith(a)||(s=`${a}${e}`);let l=await fetch(s);if(!l.ok)throw Error(`Failed to load database: ${l.statusText}`);t=await l.arrayBuffer()}this.buffer=t;let a=new Uint8Array(this.buffer);if("PCDB"!==String.fromCharCode(a[0],a[1],a[2],a[3]))throw Error("Invalid database format");let s=new DataView(this.buffer,0,256);s.getUint32(4,!0);let l=s.getUint32(12,!0),n=s.getUint32(16,!0);this.indexTable=new DataView(this.buffer,l,134456),this.dataRegion=new DataView(this.buffer,n)}getSolutions(e,t={}){if(!this.indexTable||!this.dataRegion)throw Error("Database not loaded");let{dropMode:a="single",sortByQuality:s=!0}=t,l=8*b(e),n=this.indexTable.getUint32(l,!0);if(0===this.indexTable.getUint32(l+4,!0))return null;let r=n,o=this.dataRegion.getUint16(r,!0);r+=2;let i=[];for(let t=0;t<o;t++){let t=p(this.dataRegion.getUint32(r,!0));r+=4;let s=[];for(let e=0;e<5;e++){let e=this.dataRegion.getUint16(r,!0);s.push(function(e){let t=e>>7&15;return t>=8&&(t-=16),{type:g[e>>13&7],rotation:e>>11&3,x:t,y:e>>3&15,usedHold:!1}}(e)),r+=2}("single"===a?t.singleDropReachable:t.sonicDropReachable)&&i.push({placements:s,sequence:e,initialHold:null,quality:t})}return 0===i.length?null:(s&&i.sort((e,t)=>t.quality.verticalSplitGroups!==e.quality.verticalSplitGroups?t.quality.verticalSplitGroups-e.quality.verticalSplitGroups:e.quality.complexPlacements-t.quality.complexPlacements),i)}getSolutionCount(e,t={}){if(!this.indexTable||!this.dataRegion)throw Error("Database not loaded");let{dropMode:a="single"}=t,s=8*b(e),l=this.indexTable.getUint32(s,!0);if(0===this.indexTable.getUint32(s+4,!0))return 0;let n=l,r=this.dataRegion.getUint16(n,!0);n+=2;let o=0;for(let e=0;e<r;e++){let e=p(this.dataRegion.getUint32(n,!0));n+=14,("single"===a?e.singleDropReachable:e.sonicDropReachable)&&o++}return o}hasSolution(e,t={}){return this.getSolutionCount(e,t)>0}}let k=null;async function j(e){k=new f,await k.load(e)}function y(e,t={}){if(!k)throw console.error("Database not loaded"),Error("Database not loaded");return k.getSolutions(e,t)}let N=null,v=!1;async function w(){if(!v||!N)try{if(N=await e.A(54778),"function"!=typeof N.find_perfect_clear_solutions)throw Error("WASM module is not properly initialized");v=!0}catch(e){throw console.error("[WASM INIT] Failed to initialize WASM:",e),e}}function S(e){return({I:0,O:1,T:2,S:3,Z:4,J:5,L:6})[e]}async function z(e,t={}){let{maxSolutions:a=1/0,checkReachability:s="staged",dropMode:l="sonic",useBitboard:n=!1}=t;if(v&&N||await w(),!N)throw Error("WASM module is not initialized");if(5!==e.length)throw Error(`Solver requires exactly 5 minos, got ${e.length}`);let r=new Uint8Array(e.map(S)),o=Number.isFinite(a)?Math.max(1,Math.floor(a)):0xffffffff,i=N.find_perfect_clear_solutions(r,o,+(!1!==s),+("single"!==l),n);return{solutions:i.solutions,stats:i.stats}}function T(e){return{type:e.mino_type,rotation:e.rotation,x:e.x,y:e.y,usedHold:!1}}async function C(e,t={}){let a,{initialHold:s=null,maxSolutions:l=1/0,checkReachability:n="staged",dropMode:r="sonic",includeStats:o=!1,useBitboard:i=!1,useDatabase:c=!1}=t;if(null!==s&&5===e.length){let t=function(e,t){let a=[],s=new Set;for(let l=0;l<32;l++){let n=[],r=[],o=e,i=0;for(let e=0;e<5&&((l&1<<e)!=0&&null!==o?(n.push(o),r.push(!0),o=t[i]):(n.push(t[i]),r.push(!1)),!(++i>5));e++);if(5===n.length){let e=n.join(",");s.has(e)||(s.add(e),a.push({sequence:n,holdFlags:r}))}}return a}(s,e),a=[],d={totalNodes:0,solutionsFound:0,maxDepth:0};for(let o of t){if(a.length>=l)break;let t=l-a.length,m=[];if(c){let e=y(o.sequence,{dropMode:r,sortByQuality:!0});e&&e.length>0&&(m=e.slice(0,t),d.totalNodes+=0,d.maxDepth=Math.max(d.maxDepth,5))}else{let{solutions:e,stats:a}=await z(o.sequence,{maxSolutions:t,checkReachability:n,dropMode:r,useBitboard:i});d.totalNodes+=a.total_nodes,d.maxDepth=Math.max(d.maxDepth,a.max_depth_reached),m=e.map(e=>({placements:e.placements.map(T),sequence:o.sequence,initialHold:null}))}for(let t of m){if(a.length>=l)break;let n=function(e,t,a,s){return{placements:e.placements.map((e,a)=>({...e,usedHold:t.holdFlags[a]})),sequence:[...a],initialHold:s}}(t,o,e,s);a.push(n)}}return(d.solutionsFound=a.length,await I(a),o)?{solutions:a,stats:d}:a}if(c){let t=y(e,{dropMode:r,sortByQuality:!0});if(t&&t.length>0){if(a=t.slice(0,l),o){let e={totalNodes:0,solutionsFound:a.length,maxDepth:5};return{solutions:a,stats:e}}return a}return(a=[],o)?{solutions:a,stats:{totalNodes:0,solutionsFound:0,maxDepth:0}}:a}let{solutions:d,stats:m}=await z(e,{maxSolutions:l,checkReachability:n,dropMode:r,useBitboard:i});return(a=d.map(t=>({placements:t.placements.map(T),sequence:e,initialHold:null})),await I(a),o)?{solutions:a,stats:{totalNodes:m.total_nodes,solutionsFound:m.solutions_found,maxDepth:m.max_depth_reached}}:a}async function D(e){if(v&&N||await w(),!N)throw Error("WASM module is not initialized");return N.evaluate_solution_quality_wasm(e)}async function I(e){v&&N||await w();let t=await Promise.all(e.map(e=>D({placements:e.placements.map(e=>({mino_type:e.type,x:e.x,y:e.y,rotation:e.rotation,used_hold:e.usedHold})),sequence:e.sequence,initial_hold:e.initialHold}))),a=e.map((e,t)=>t);a.sort((e,a)=>{let s=t[e],l=t[a];return l.vertical_split_groups!==s.vertical_split_groups?l.vertical_split_groups-s.vertical_split_groups:s.needs_complex_placement-l.needs_complex_placement});let s=a.map(t=>e[t]);e.splice(0,e.length,...s)}let F="k-trainer-bookmarks",B="k-trainer-tags",M=e=>{let t=["I","O","T","S","Z","J","L"];return e.toUpperCase().replace(/[^IOTSZJL]/g,"").split("").filter(e=>t.includes(e))},P={I:"bg-red-500",O:"bg-yellow-500",T:"bg-cyan-500",S:"bg-pink-500",Z:"bg-green-500",J:"bg-blue-500",L:"bg-orange-500",empty:"bg-zinc-800"},R=({type:e,size:a="normal"})=>{let s,l,n,r,o=c[e],i="small"===a?"w-3 h-3":"w-5 h-5",d=(s=4,l=-1,n=4,r=-1,o.forEach((e,t)=>{e.forEach((e,a)=>{e&&(s=Math.min(s,t),l=Math.max(l,t),n=Math.min(n,a),r=Math.max(r,a))})}),{minRow:s,maxRow:l,minCol:n,maxCol:r}),m=o.slice(d.minRow,d.maxRow+1).map(e=>e.slice(d.minCol,d.maxCol+1)),u=m[0].length;return(0,t.jsx)("div",{className:"grid gap-0.5",style:{gridTemplateColumns:`repeat(${u}, minmax(0, 1fr))`},children:m.flat().map((a,s)=>(0,t.jsx)("div",{className:`${i} ${a?P[e]:"bg-transparent"} ${a?"border border-black/20":""}`},s))})};function _({board:e}){return(0,t.jsx)("div",{className:"bg-black p-1 sm:p-2 rounded-lg border-2 sm:border-4 border-zinc-700",children:(0,t.jsx)("div",{className:"grid grid-rows-10 gap-0.5",children:e.map((e,a)=>(0,t.jsx)("div",{className:"flex gap-0.5",children:e.map((e,a)=>(0,t.jsx)("div",{className:`w-6 h-6 sm:w-10 sm:h-10 lg:w-12 lg:h-12 ${P[e]} ${"empty"===e?"border border-zinc-700":"border border-black"}`},a))},a))})})}function $({holdPiece:e}){let{t:a}=(0,s.useI18n)();return(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-2 sm:p-3 lg:p-4 rounded-lg border-2 border-zinc-700 w-20 sm:w-24 lg:w-28",children:[(0,t.jsx)("h2",{className:"text-white text-xs sm:text-sm font-bold mb-2 sm:mb-3 text-center",children:a.game.hold}),(0,t.jsx)("div",{className:"h-14 sm:h-16 lg:h-20 flex items-center justify-center",children:e?(0,t.jsx)(R,{type:e,size:"small"}):(0,t.jsx)("div",{className:"text-zinc-500 text-xs sm:text-sm text-center",children:"-"})})]})})}function q({nextMinos:e}){let{t:a}=(0,s.useI18n)();return(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-2 sm:p-3 lg:p-4 rounded-lg border-2 border-zinc-700 w-20 sm:w-24 lg:w-28",children:[(0,t.jsx)("h2",{className:"text-white text-xs sm:text-sm font-bold mb-2 sm:mb-3 text-center",children:a.game.nextLabel}),(0,t.jsx)("div",{className:"flex flex-col gap-1 sm:gap-1.5 lg:gap-2",children:[0,1,2,3,4].map(a=>(0,t.jsx)("div",{className:"h-12 sm:h-14 lg:h-16 flex items-center justify-center",children:e[a]?(0,t.jsx)(R,{type:e[a],size:"small"}):(0,t.jsx)("div",{className:"text-zinc-500 text-xs text-center",children:"-"})},a))})]})})}function J({onPrevStep:e,onNextStep:a,onReset:l,currentStep:n,solutionLength:r}){let{t:o}=(0,s.useI18n)();return(0,t.jsxs)("div",{className:"flex gap-2 sm:gap-3 lg:gap-4 items-stretch sm:items-center justify-center mb-3 sm:mb-4",children:[(0,t.jsx)("button",{type:"button",onClick:e,disabled:0===n,className:"flex-1 sm:flex-none px-4 sm:px-5 lg:px-6 py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",children:o.game.prev}),(0,t.jsx)("button",{type:"button",onClick:l,disabled:0===n,className:"px-3 sm:px-4 py-3 bg-zinc-700 hover:bg-zinc-600 active:bg-zinc-500 disabled:bg-zinc-800 disabled:text-zinc-600 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",children:o.common.reset}),(0,t.jsx)("button",{type:"button",onClick:a,disabled:n>=r,className:"flex-1 sm:flex-none px-4 sm:px-5 lg:px-6 py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",children:o.game.next})]})}function L({onPrevSolution:e,onNextSolution:a,currentSolutionIndex:l,allSolutionsLength:n}){let{t:r}=(0,s.useI18n)();return(0,t.jsx)("div",{className:"bg-zinc-800 p-3 rounded-lg border-2 border-zinc-700 mb-3 sm:mb-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:e,disabled:0===l||0===n,className:"px-3 py-2 bg-purple-600 hover:bg-purple-700 active:bg-purple-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm",children:r.game.prevSolution}),(0,t.jsx)("span",{className:"text-white text-sm font-bold",children:n>0?(0,t.jsxs)(t.Fragment,{children:[r.game.solution," ",l+1," / ",n]}):(0,t.jsxs)(t.Fragment,{children:[r.game.solution," 0 / 0"]})}),(0,t.jsx)("button",{type:"button",onClick:a,disabled:l>=n-1||0===n,className:"px-3 py-2 bg-purple-600 hover:bg-purple-700 active:bg-purple-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm",children:r.game.nextSolution})]})})}function O(e){let{t:a}=(0,s.useI18n)(),{inputMode:l,setInputMode:n,difficulty:r,setDifficulty:o,inputHold:i,setInputHold:c,inputNext:d,setInputNext:m,useDatabase:u,setUseDatabase:x,dropMode:h,setDropMode:g,checkReachability:p,setCheckReachability:b,useBitboard:f,setUseBitboard:k,randomFromTag:j,setRandomFromTag:y,tags:N,bookmarks:v,getTagName:w}=e;return(0,t.jsxs)("details",{className:"bg-zinc-800 p-3 sm:p-4 lg:p-5 rounded-lg border-2 border-zinc-700 mb-3 sm:mb-4",children:[(0,t.jsx)("summary",{className:"text-white text-sm sm:text-base font-bold cursor-pointer hover:text-zinc-300 transition-colors select-none",children:a.options.title}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:gap-4 mt-3 sm:mt-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.problemGenerator.generationMode,":"]}),(0,t.jsx)("div",{className:"flex gap-3 sm:gap-4",children:["random","bookmark","manual"].map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:e,checked:l===e,onChange:e=>n(e.currentTarget.value),className:"w-4 h-4"}),(0,t.jsx)("span",{className:"text-white text-sm sm:text-base",children:a.problemGenerator[e]})]},e))})]}),"bookmark"===l&&(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsx)("div",{className:"text-white text-sm font-bold mb-2",children:a.problemGenerator.randomFromTag}),(0,t.jsx)("select",{value:j,onChange:e=>y(e.currentTarget.value),className:"w-full px-3 py-2 bg-zinc-700 text-white rounded border border-zinc-600 focus:border-blue-500 focus:outline-none text-sm sm:text-base",children:N.map(e=>(0,t.jsxs)("option",{value:e.id,children:[w(e)," (","default-all"===e.id?v.length:v.filter(t=>t.tags.includes(e.id)).length,")"]},e.id))})]}),"random"===l&&(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.problemGenerator.difficulty,":"]}),(0,t.jsx)("div",{className:"flex gap-3 sm:gap-4",children:["easy","hard"].map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:e,checked:r===e,onChange:e=>o(e.currentTarget.value),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm sm:text-base",children:[a.problemGenerator[e],(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.problemGenerator["easy"===e?"excludeSZ":"all7Types"]})]})]},e))})]}),"manual"===l&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"text-white text-xs sm:text-sm mb-1 block",children:a.problemGenerator.holdInput}),(0,t.jsx)("input",{type:"text",value:i,onChange:e=>c(e.currentTarget.value),placeholder:a.problemGenerator.holdPlaceholder,className:"w-full px-3 py-2 bg-zinc-700 text-white rounded border border-zinc-600 focus:border-blue-500 focus:outline-none text-sm sm:text-base uppercase",maxLength:1})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"text-white text-xs sm:text-sm mb-1 block",children:a.problemGenerator.nextInput}),(0,t.jsx)("input",{type:"text",value:d,onChange:e=>m(e.currentTarget.value),placeholder:a.problemGenerator.nextPlaceholder,className:"w-full px-3 py-2 bg-zinc-700 text-white rounded border border-zinc-600 focus:border-blue-500 focus:outline-none text-sm sm:text-base uppercase font-mono",maxLength:10})]})]}),(0,t.jsx)("div",{className:"text-zinc-400 text-xs",children:a.problemGenerator.validMinos})]}),(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.options.solutionMethod,":"]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:"database",checked:u,onChange:()=>x(!0),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-sm text-white",children:[a.options.database,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.databaseFast})]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:"solver",checked:!u,onChange:()=>x(!1),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.solver,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.solverHold})]})]})]})]}),!u&&(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.options.dropMode,":"]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:"sonic",checked:"sonic"===h,onChange:()=>g("sonic"),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.sonicDrop,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.sonicFast})]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:"single",checked:"single"===h,onChange:()=>g("single"),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.singleMove,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.singleDebug})]})]})]})]}),!u&&(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.options.additionalSettings,":"]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4 pl-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-zinc-300 text-xs font-semibold mb-2",children:a.options.reachabilityCheck}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:"staged",checked:"staged"===p,onChange:()=>b("staged"),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.staged,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.recommended})]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:"false",checked:!1===p,onChange:()=>b(!1),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.noCheck,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.includesInvalid})]})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-zinc-300 text-xs font-semibold mb-2",children:a.options.bitboard}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:"false",checked:!f,onChange:()=>k(!1),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.normal,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.normalFast})]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:"true",checked:f,onChange:()=>k(!0),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.bitboard,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.bitboardExperimental})]})]})]})]})]})]})]})]})}function U(e){let{t:l}=(0,s.useI18n)(),{show:n,onClose:r,bookmarks:o,tags:i,onLoadBookmark:c,getTagName:d,getTagColorClass:m,selectedFilterTag:u,setSelectedFilterTag:x,clearBookmarks:h,deleteBookmark:g,addTag:p,renameTag:b,deleteTag:f,addTagToBookmark:k,removeTagFromBookmark:j}=e,[y,N]=(0,a.useState)(!1),[v,w]=(0,a.useState)(null);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:`fixed top-0 right-0 h-full bg-zinc-800 border-l-2 border-zinc-700 transition-transform duration-300 z-40 ${n?"translate-x-0":"translate-x-full"} w-80 sm:w-96 overflow-y-auto`,children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4 sticky top-0 bg-zinc-800 pb-2 border-b border-zinc-700",children:[(0,t.jsx)("h3",{className:"text-white text-lg font-bold",children:l.bookmark.title}),(0,t.jsx)("button",{type:"button",onClick:r,className:"px-3 py-1.5 bg-zinc-600 hover:bg-zinc-700 text-white text-sm rounded transition-colors",children:l.bookmark.close})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("div",{className:"text-white text-sm font-bold mb-2",children:l.bookmark.filterByTag}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:i.map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>x(e.id),className:`px-2 py-1 rounded text-xs transition-all ${u===e.id?`${m(e.color)} text-white font-bold`:"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}`,children:[d(e),(0,t.jsxs)("span",{className:"ml-1 text-xs",children:["(","default-all"===e.id?o.length:o.filter(t=>t.tags.includes(e.id)).length,")"]})]},e.id))})]}),(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("button",{type:"button",onClick:()=>N(!y),className:"w-full px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded transition-colors",children:y?l.bookmark.closeTagManagement:l.bookmark.tagManagement})}),y&&(0,t.jsxs)("div",{className:"mb-4 p-3 bg-zinc-700 rounded-lg border border-zinc-600",children:[(0,t.jsx)("div",{className:"text-white text-sm font-bold mb-3",children:l.bookmark.manageTagsTitle}),(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("button",{type:"button",onClick:()=>{let e=prompt(l.bookmark.enterTagName);if(e?.trim()){let t=["red","orange","yellow","green","blue","purple","pink"];p(e.trim(),t[Math.floor(Math.random()*t.length)])}},className:"w-full px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-xs rounded transition-colors",children:l.bookmark.addNewTag})}),(0,t.jsxs)("div",{className:"space-y-2",children:[i.filter(e=>!e.isDefault).map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-zinc-800 rounded",children:[(0,t.jsx)("span",{className:`flex-1 px-2 py-1 rounded text-xs ${m(e.color)} text-white`,children:d(e)}),(0,t.jsx)("button",{type:"button",onClick:()=>{let t=prompt(l.bookmark.enterNewName,e.name);t?.trim()&&b(e.id,t.trim())},className:"px-2 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors",title:l.bookmark.rename,children:"âœŽ"}),(0,t.jsx)("button",{type:"button",onClick:()=>{confirm(l.bookmark.confirmDeleteTag.replace("{name}",e.name))&&f(e.id)},className:"px-2 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition-colors",title:l.common.delete,children:"âœ•"})]},e.id)),0===i.filter(e=>!e.isDefault).length&&(0,t.jsx)("div",{className:"text-zinc-500 text-xs text-center py-2",children:l.bookmark.noCustomTags})]})]}),0===o.length?(0,t.jsx)("div",{className:"text-zinc-500 text-center py-12 text-sm",children:"default-all"===u?l.bookmark.empty:l.bookmark.emptyFiltered}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mb-3 flex justify-end",children:(0,t.jsx)("button",{type:"button",onClick:()=>{confirm(l.bookmark.confirmDeleteAll)&&h()},className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition-colors",children:l.bookmark.deleteAll})}),(0,t.jsx)("div",{className:"space-y-2",children:o.map(e=>(0,t.jsx)("div",{className:"bg-zinc-700 p-3 rounded-lg border border-zinc-600 hover:border-zinc-500 transition-colors",children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"text-white font-bold text-sm break-words",children:e.name}),(0,t.jsxs)("div",{className:"text-zinc-400 text-xs font-mono",children:[e.holdPiece&&`[${e.holdPiece}] `,e.sequence.join("")]}),(0,t.jsx)("div",{className:"text-zinc-500 text-xs",children:new Date(e.createdAt).toLocaleString("ja-JP")}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-1 items-center",children:[e.tags.map(a=>{let s=i.find(e=>e.id===a);return s?(0,t.jsxs)("span",{className:`px-2 py-0.5 rounded text-xs ${m(s.color)} text-white flex items-center gap-1`,children:[d(s),(0,t.jsx)("button",{type:"button",onClick:t=>{t.stopPropagation(),j(e.id,a)},className:"hover:text-red-300",title:l.bookmark.removeTag,children:"âœ•"})]},a):null}),(0,t.jsx)("button",{type:"button",onClick:()=>w(v===e.id?null:e.id),className:"px-2 py-0.5 bg-zinc-600 hover:bg-zinc-500 text-white text-xs rounded transition-colors",title:l.bookmark.addTagTooltip,children:"ï¼‹"})]}),v===e.id&&(0,t.jsxs)("div",{className:"p-2 bg-zinc-800 rounded border border-zinc-600",children:[(0,t.jsxs)("div",{className:"text-white text-xs mb-2",children:[l.bookmark.addTag,":"]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[i.filter(t=>!t.isDefault&&!e.tags.includes(t.id)).map(a=>(0,t.jsx)("button",{type:"button",onClick:()=>{k(e.id,a.id),w(null)},className:`px-2 py-1 rounded text-xs ${m(a.color)} text-white hover:opacity-80 transition-opacity`,children:d(a)},a.id)),0===i.filter(t=>!t.isDefault&&!e.tags.includes(t.id)).length&&(0,t.jsx)("div",{className:"text-zinc-500 text-xs",children:l.bookmark.noTagsToAdd})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,t.jsx)("button",{type:"button",onClick:()=>c(e),className:"flex-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded transition-colors",children:l.bookmark.load}),(0,t.jsx)("button",{type:"button",onClick:()=>{confirm(l.bookmark.confirmDelete.replace("{name}",e.name))&&g(e.id)},className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-sm rounded transition-colors",children:l.common.delete})]})]})},e.id))})]})]})}),n&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-30",onClick:r})]})}function E(e){let{t:a}=(0,s.useI18n)(),{show:l,onClose:n,onConfirm:r,tags:o,selectedTags:i,onToggleTag:c,getTagName:d,getTagColorClass:m}=e;return l?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-6 rounded-lg border-2 border-zinc-700 max-w-md w-full",children:[(0,t.jsx)("h3",{className:"text-white text-lg font-bold mb-4",children:a.bookmark.selectTags}),(0,t.jsxs)("div",{className:"mb-4 max-h-60 overflow-y-auto",children:[o.filter(e=>!e.isDefault).map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-2 p-2 hover:bg-zinc-700 rounded cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:i.includes(e.id),onChange:()=>c(e.id),className:"w-4 h-4"}),(0,t.jsx)("span",{className:`px-2 py-1 rounded text-xs ${m(e.color)} text-white`,children:d(e)})]},e.id)),0===o.filter(e=>!e.isDefault).length&&(0,t.jsx)("div",{className:"text-zinc-500 text-sm text-center py-4",children:a.bookmark.noTags})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:a.common.save}),(0,t.jsx)("button",{type:"button",onClick:n,className:"flex-1 px-4 py-2 bg-zinc-600 hover:bg-zinc-700 text-white rounded transition-colors",children:a.common.cancel})]})]})}):null}function G({show:e,message:a}){let{t:l}=(0,s.useI18n)();return e?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-6 sm:p-8 rounded-lg border-2 border-zinc-700 text-center max-w-md mx-4",children:[(0,t.jsx)("div",{className:"text-white text-lg sm:text-xl mb-4",children:a||l.common.initializing}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})})]})}):null}function H({error:e,onClose:a}){let{t:l}=(0,s.useI18n)();return e?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-6 sm:p-8 rounded-lg border-2 border-zinc-700 text-center max-w-md mx-4",children:[(0,t.jsx)("div",{className:"text-red-500 text-lg sm:text-xl mb-4",children:e}),(0,t.jsx)("button",{type:"button",onClick:a,className:"px-6 py-3 bg-zinc-600 hover:bg-zinc-700 text-white rounded-lg font-bold transition-colors",children:l.common.close})]})}):null}function A(){let{t:e}=(0,s.useI18n)(),r=function(){var e;let t,l=(0,n.useSearchParams)(),r=(0,n.useRouter)(),{t:o}=(0,s.useI18n)(),[h,g]=(0,a.useState)([]),[p,b]=(0,a.useState)(null),[f,k]=(0,a.useState)([]),[N,v]=(0,a.useState)(0),[S,z]=(0,a.useState)([]),[T,D]=(0,a.useState)(0),[I,P]=(0,a.useState)(!1),[R,_]=(0,a.useState)(""),[$,q]=(0,a.useState)(""),[J,L]=(0,a.useState)(!1),[O,U]=(0,a.useState)(!1),[E,G]=(0,a.useState)("random"),[H,A]=(0,a.useState)(""),[Z,W]=(0,a.useState)(""),[Q,V]=(0,a.useState)("hard"),[K,X]=(0,a.useState)(!0),[Y,ee]=(0,a.useState)("staged"),[et,ea]=(0,a.useState)("sonic"),[es,el]=(0,a.useState)(!1),en=function(){let{t:e}=(0,s.useI18n)(),t=[{id:"default-all",name:e.common.all,color:"gray",isDefault:!0}],[l,n]=(0,a.useState)([]),[r,o]=(0,a.useState)(t);(0,a.useEffect)(()=>{try{let e=localStorage.getItem(F);if(e){let t=JSON.parse(e).map(e=>({...e,tags:e.tags||[]}));n(t)}let a=localStorage.getItem(B);if(a){let e=JSON.parse(a).filter(e=>!e.isDefault);o([...t,...e])}}catch(e){console.error("Failed to load bookmarks:",e)}},[]);let i=e=>{try{localStorage.setItem(F,JSON.stringify(e)),n(e)}catch(e){console.error("Failed to save bookmarks:",e)}},c=e=>{try{let t=e.filter(e=>!e.isDefault);localStorage.setItem(B,JSON.stringify(t)),o(e)}catch(e){console.error("Failed to save tags:",e)}};return{bookmarks:l,tags:r,addBookmark:(e,t,a,s,n=[])=>{try{let r,o=l.find(e=>{var s,l;return s=e.sequence,l=e.holdPiece,s.length===t.length&&l===a&&s.every((e,a)=>e===t[a])});if(o)r=l.map(t=>t.id===o.id?{...t,name:e,solution:s,tags:n}:t);else{let o={id:Date.now().toString(),name:e,sequence:t,holdPiece:a,solution:s,createdAt:Date.now(),tags:n};r=[...l,o]}return i(r),!0}catch(e){return console.error("Failed to add bookmark:",e),!1}},deleteBookmark:e=>{i(l.filter(t=>t.id!==e))},clearBookmarks:()=>{i([])},addTag:(e,t)=>{try{let a={id:`tag-${Date.now()}`,name:e,color:t,isDefault:!1},s=[...r,a];return c(s),!0}catch(e){return console.error("Failed to add tag:",e),!1}},deleteTag:e=>{let t=r.find(t=>t.id===e);if(t?.isDefault)return console.error("Cannot delete default tag"),!1;try{let t=r.filter(t=>t.id!==e);c(t);let a=l.map(t=>({...t,tags:t.tags.filter(t=>t!==e)}));return i(a),!0}catch(e){return console.error("Failed to delete tag:",e),!1}},renameTag:(e,t)=>{let a=r.find(t=>t.id===e);if(a?.isDefault)return console.error("Cannot rename default tag"),!1;try{let a=r.map(a=>a.id===e?{...a,name:t}:a);return c(a),!0}catch(e){return console.error("Failed to rename tag:",e),!1}},changeTagColor:(e,t)=>{let a=r.find(t=>t.id===e);if(a?.isDefault)return console.error("Cannot change default tag color"),!1;try{let a=r.map(a=>a.id===e?{...a,color:t}:a);return c(a),!0}catch(e){return console.error("Failed to change tag color:",e),!1}},addTagToBookmark:(e,t)=>{try{let a=l.map(a=>a.id!==e||a.tags.includes(t)?a:{...a,tags:[...a.tags,t]});return i(a),!0}catch(e){return console.error("Failed to add tag to bookmark:",e),!1}},removeTagFromBookmark:(e,t)=>{try{let a=l.map(a=>a.id===e?{...a,tags:a.tags.filter(e=>e!==t)}:a);return i(a),!0}catch(e){return console.error("Failed to remove tag from bookmark:",e),!1}},getRandomBookmarkByTag:e=>{let t="default-all"===e?l:l.filter(t=>t.tags.includes(e));if(0===t.length)return null;let a=Math.floor(Math.random()*t.length);return t[a]}}}(),[er,eo]=(0,a.useState)(!1),[ei,ec]=(0,a.useState)(!1),[ed,em]=(0,a.useState)([]),[eu,ex]=(0,a.useState)("default-all"),[eh,eg]=(0,a.useState)("default-all"),[ep,eb]=(0,a.useState)(!1),[ef,ek]=(0,a.useState)(null),[ej,ey]=(0,a.useState)(!0),[eN,ev]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{_(o.common.initializing),await w(),L(!0);try{_(o.common.loadingDatabase),await j("/precomputed-patterns.pcdb"),U(!0)}catch(e){console.warn("DB load failed, solver mode:",e),U(!1)}finally{ev(!0)}}catch(e){q("WASMã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(e instanceof Error?e.message:String(e))),ev(!0)}})()},[o.common.initializing,o.common.loadingDatabase]);let ew=(0,a.useCallback)(async(e,t)=>{if(J){P(!0),_("å•é¡Œã‚’ç”Ÿæˆä¸­..."),q(""),await new Promise(e=>setTimeout(e,0));try{let a;if(K&&O&&!t){let t=y(e,{dropMode:et,sortByQuality:!0});if(t&&t.length>0)a=t;else{q(o.error.noSequenceInDatabase),P(!1);return}}else a=await C(e,{initialHold:t,checkReachability:Y,dropMode:et,useBitboard:es,useDatabase:K&&O});if(a.length>0){let s=a.map(e=>e.placements);k(s),v(0),g(e),b(t),z(s[0]),D(0)}else q(o.error.noSolution)}catch(e){q("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+(e instanceof Error?e.message:String(e)))}finally{P(!1)}}},[J,K,O,et,Y,es,o.error.noSequenceInDatabase,o.error.noSolution]);(0,a.useEffect)(()=>{if(!J||!ej||!eN)return;let e=l.get("hold"),t=l.get("next"),a=l.get("mode"),s=l.get("reach"),n=l.get("drop"),r=l.get("bitboard"),o=l.get("db"),i=l.get("difficulty");if("manual"===a?G("manual"):G("random"),"easy"===i?V("easy"):V("hard"),"false"===o?X(!1):X(!0),"false"===s?ee(!1):ee("staged"),"single"===n?ea("single"):ea("sonic"),"true"===r?el(!0):el(!1),t){let s=M(t);5===s.length&&("manual"===a&&(W(t.toUpperCase()),e&&M(e).length<=1&&A(e.toUpperCase())),setTimeout(()=>{ew(s,e?M(e)[0]:null)},100))}ey(!1)},[J,ej,eN,l,ew]);let eS=(0,a.useCallback)((e,t,a,s,l,n,o,i)=>{let c=new URLSearchParams;5===e.length&&(c.set("next",e.join("")),t&&c.set("hold",t),"manual"===a&&c.set("mode","manual")),"staged"!==s&&c.set("reach",String(s)),"sonic"!==l&&c.set("drop",l),!1!==n&&c.set("bitboard",String(n)),!0!==o&&c.set("db",String(o)),"hard"!==i&&c.set("difficulty",i);let d=c.toString()?`?${c.toString()}`:"/";r.push(d,{scroll:!1})},[r]),ez=(0,a.useCallback)(async e=>{g(e.sequence),b(e.holdPiece),z(e.solution),D(0),P(!0);try{let t=[];if(!e.holdPiece&&K&&O){let a=y(e.sequence);a&&a.length>0&&(t=a)}if(0===t.length&&(t=await C(e.sequence,{initialHold:e.holdPiece,checkReachability:Y,dropMode:et,useBitboard:es,useDatabase:K&&O})),t.length>0){let a=t.map(e=>e.placements);k(a);let s=a.findIndex(t=>JSON.stringify(t)===JSON.stringify(e.solution));v(-1!==s?s:0)}else k([e.solution]),v(0)}catch(t){console.error("Failed to recalculate solutions:",t),k([e.solution]),v(0)}finally{P(!1)}eS(e.sequence,e.holdPiece,E,Y,et,es,K,Q)},[en.bookmarks,K,O,Y,et,es,eS,E,Q]),eT=(0,a.useCallback)(async()=>{if(!J)return void q(o.error.wasmInit);P(!0),_(o.problemGenerator.generating),q(""),await new Promise(e=>setTimeout(e,0));try{if("bookmark"===E){let e=en.getRandomBookmarkByTag(eh);if(e)await ez(e);else{let e=en.tags.find(e=>e.id===eh),t=e?eM(e):o.common.all;q(o.error.noBookmarkInTag.replace("{tag}",t))}P(!1);return}let e=[],t=null,a=[];if("manual"===E){let s,l=M(H),n=M(Z);if(5!==n.length){q(o.error.nextRequired.replace("{count}",String(n.length))),P(!1);return}if(l.length>1){q(o.error.holdRequired.replace("{count}",String(l.length))),P(!1);return}if(e=n,t=1===l.length?l[0]:null,K&&O&&!t){let t=y(e,{dropMode:et,sortByQuality:!0});if(t&&t.length>0)s=t;else{q(o.error.noSequenceInDatabase),P(!1);return}}else s=await C(e,{initialHold:t,checkReachability:Y,dropMode:et,useBitboard:es,useDatabase:K&&O});if(s.length>0){let e=s.map(e=>e.placements);k(e),v(0),a=e[0]}else q(o.error.noSolution)}else{let s=0;for(;0===a.length&&s<10;){let l;s++,_(`${o.problemGenerator.generating} (${s}${o.problemGenerator.attempt})`),s%5==0&&await new Promise(e=>setTimeout(e,0));let{sequence:n,hold:r}=function(e="hard"){let t=function(e="hard"){let t=[..."easy"===e?["J","J","L","L"]:["Z","Z","S","S"]],a=[];for(let s=0;s<10;s++){let{mino:s,newHistory:l}=function(e,t="hard"){let a=null,s="easy"===t?x.filter(e=>"S"!==e&&"Z"!==e):x;for(let t=0;t<6;t++){let l=Math.floor(Math.random()*s.length),n=s[l];if(!e.includes(n)){a=n;break}5===t&&(a=n)}let l=[a,...e.slice(0,3)];return{mino:a,newHistory:l}}(t,e);a.push(s),t=l}return a}(e),a=t[4];return{sequence:t.slice(5,10),hold:a}}(Q);if(e=n,t=r,K&&O&&!t){let t=y(e,{dropMode:et,sortByQuality:!0});if(!t||!(t.length>0))continue;l=t}else l=await C(e,{initialHold:t,checkReachability:Y,dropMode:et,useBitboard:es,useDatabase:K&&O});if(l.length>0){let e=l.map(e=>e.placements);k(e),v(0),a=e[0]}}0===a.length&&q(o.error.attempts)}a.length>0&&(g(e),b(t),z(a),D(0),eS(e,t,E,Y,et,es,K,Q))}catch(e){q("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+(e instanceof Error?e.message:String(e)))}finally{P(!1)}},[J,o,E,en,eh,ez,H,Z,K,O,et,Y,es,Q,eS]),eC=S.length>0?(e=S.slice(0,T),t=Array(10).fill(null).map(()=>[,,,,,].fill("empty")),e.forEach((e,a)=>{a>0&&(t=(function(e){let t=[];for(let a=0;a<10;a++){let s=e[a];s.every(e=>0!==e)||t.push([...s])}let a=10-t.length;for(let e=0;e<a;e++)t.unshift([,,,,,].fill(0));return t})(t.map(e=>e.map(m))).map(e=>e.map(u)));let s=e.type;(function(e,t,a){if(a){let e=d(a,t);return i[a][e]}for(let a of Object.keys(c))if(JSON.stringify(c[a])===JSON.stringify(e)){let e=d(a,t);return i[a][e]}return e})(c[s],e.rotation,s).forEach((a,l)=>{a.forEach((a,n)=>{if(a){let a=e.y+l,r=e.x+n;a>=0&&a<10&&r>=0&&r<5&&(t[a][r]=s)}})})}),t):Array(10).fill(null).map(()=>[,,,,,].fill("empty")),eD=(()=>{let e=p;for(let t=0;t<T;t++)S[t].usedHold&&(e=h[t]);return e})(),eI=h.slice(T),eF=async()=>{try{await navigator.clipboard.writeText(window.location.href),alert(o.bookmark.urlCopied)}catch(e){console.error("Failed to copy to clipboard:",e),alert(o.bookmark.urlCopyFailed)}},eB=en.bookmarks.filter(e=>"default-all"===eu||e.tags.includes(eu)),eM=e=>"default-all"===e.id?o.common.all:e.name;return{sequence:h,holdPiece:p,allSolutions:f,currentSolutionIndex:N,solution:S,currentStep:T,isLoading:I,loadingMessage:R,error:$,wasmInitialized:J,isDatabaseInitialized:eN,inputMode:E,inputHold:H,inputNext:Z,difficulty:Q,useDatabase:K,checkReachability:Y,dropMode:et,useBitboard:es,randomFromTag:eh,board:eC,currentHold:eD,nextMinos:eI,showBookmarkSidebar:er,showSaveModal:ei,selectedTagsForSave:ed,selectedFilterTag:eu,showTagEditor:ep,editingBookmarkId:ef,filteredBookmarks:eB,setSequence:g,setHoldPiece:b,setAllSolutions:k,setCurrentSolutionIndex:v,setSolution:z,setCurrentStep:D,setIsLoading:P,setLoadingMessage:_,setError:q,setWasmInitialized:L,setDatabaseLoaded:U,setInputMode:G,setInputHold:A,setInputNext:W,setDifficulty:V,setUseDatabase:X,setCheckReachability:ee,setDropMode:ea,setUseBitboard:el,setShowBookmarkSidebar:eo,setShowSaveModal:ec,setSelectedTagsForSave:em,setSelectedFilterTag:ex,setRandomFromTag:eg,setShowTagEditor:eb,setEditingBookmarkId:ek,handlePrevStep:()=>D(e=>Math.max(0,e-1)),handleNextStep:()=>D(e=>Math.min(S.length,e+1)),handleReset:()=>D(0),handlePrevSolution:()=>{if(N>0){let e=N-1;v(e),z(f[e]),D(0)}},handleNextSolution:()=>{if(N<f.length-1){let e=N+1;v(e),z(f[e]),D(0)}},handleNewProblem:()=>eT(),handleCopyUrl:eF,handleSaveBookmark:()=>{if(0===S.length)return void alert(o.bookmark.failed);let e=en.bookmarks.find(e=>JSON.stringify(e.sequence)===JSON.stringify(h)&&e.holdPiece===p);ec(!0),em(e?e.tags:[])},confirmSaveBookmark:()=>{if(0===S.length)return;let e=p?`[${p}] ${h.join("")}`:h.join(""),t=new Date().toLocaleString("ja-JP",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),a=`${e} (${t})`;en.addBookmark(a,h,p,S,ed)?(alert(o.bookmark.saved),ec(!1),em([])):alert(o.bookmark.failed)},toggleTagForSave:e=>{em(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},handleLoadBookmark:ez,getTagName:eM,getTagColorClass:e=>({gray:"bg-gray-600",red:"bg-red-600",orange:"bg-orange-600",yellow:"bg-yellow-600",green:"bg-green-600",blue:"bg-blue-600",purple:"bg-purple-600",pink:"bg-pink-600"})[e]||"bg-gray-600",...en}}();return(0,t.jsxs)("div",{className:"min-h-screen bg-zinc-900 font-sans p-2 sm:p-4 relative flex",children:[(0,t.jsx)(G,{show:!r.wasmInitialized||!r.isDatabaseInitialized,message:r.loadingMessage||e.common.initializing}),(0,t.jsx)(H,{error:r.error,onClose:()=>r.setError("")}),(0,t.jsx)(E,{show:r.showSaveModal,onClose:()=>{r.setShowSaveModal(!1),r.setSelectedTagsForSave([])},onConfirm:r.confirmSaveBookmark,tags:r.tags,selectedTags:r.selectedTagsForSave,onToggleTag:r.toggleTagForSave,getTagName:r.getTagName,getTagColorClass:r.getTagColorClass}),(0,t.jsx)(U,{show:r.showBookmarkSidebar,onClose:()=>r.setShowBookmarkSidebar(!1),bookmarks:r.filteredBookmarks,tags:r.tags,onLoadBookmark:r.handleLoadBookmark,getTagName:r.getTagName,getTagColorClass:r.getTagColorClass,selectedFilterTag:r.selectedFilterTag,setSelectedFilterTag:r.setSelectedFilterTag,clearBookmarks:r.clearBookmarks,deleteBookmark:r.deleteBookmark,addTag:r.addTag,renameTag:r.renameTag,deleteTag:r.deleteTag,addTagToBookmark:r.addTagToBookmark,removeTagFromBookmark:r.removeTagFromBookmark}),(0,t.jsxs)("div",{className:"flex-1 max-w-6xl mx-auto w-full",children:[(0,t.jsx)(G,{show:r.isLoading,message:r.loadingMessage}),(0,t.jsx)("div",{className:"flex justify-end mb-3",children:(0,t.jsx)(l,{})}),(0,t.jsxs)("div",{className:"text-center mb-3 sm:mb-4",children:[(0,t.jsx)("h1",{className:"text-white text-xl sm:text-2xl font-bold mb-1 sm:mb-2",children:e.common.appTitle}),(0,t.jsx)("div",{className:"text-zinc-400 text-xs sm:text-sm",children:r.solution.length>0?(0,t.jsxs)(t.Fragment,{children:[e.game.step,": ",r.currentStep," / ",r.solution.length,r.currentStep===r.solution.length&&(0,t.jsxs)("span",{className:"ml-2 sm:ml-4 text-green-500 font-bold",children:["âœ“ ",e.game.complete]})]}):(0,t.jsx)("span",{children:e.game.clickToStart})})]}),(0,t.jsxs)("div",{className:"flex gap-2 sm:gap-4 lg:gap-6 items-start justify-center mb-3 sm:mb-4 overflow-x-auto",children:[(0,t.jsx)($,{holdPiece:r.currentHold}),(0,t.jsx)(_,{board:r.board}),(0,t.jsx)(q,{nextMinos:r.nextMinos})]}),(0,t.jsx)(L,{onPrevSolution:r.handlePrevSolution,onNextSolution:r.handleNextSolution,currentSolutionIndex:r.currentSolutionIndex,allSolutionsLength:r.allSolutions.length}),(0,t.jsx)(J,{onPrevStep:r.handlePrevStep,onNextStep:r.handleNextStep,onReset:r.handleReset,currentStep:r.currentStep,solutionLength:r.solution.length}),(0,t.jsx)(O,{inputMode:r.inputMode,setInputMode:r.setInputMode,difficulty:r.difficulty,setDifficulty:r.setDifficulty,inputHold:r.inputHold,setInputHold:r.setInputHold,inputNext:r.inputNext,setInputNext:r.setInputNext,useDatabase:r.useDatabase,setUseDatabase:r.setUseDatabase,dropMode:r.dropMode,setDropMode:r.setDropMode,checkReachability:r.checkReachability,setCheckReachability:r.setCheckReachability,useBitboard:r.useBitboard,setUseBitboard:r.setUseBitboard,randomFromTag:r.randomFromTag,setRandomFromTag:r.setRandomFromTag,tags:r.tags,bookmarks:r.bookmarks,getTagName:r.getTagName}),(0,t.jsxs)("div",{className:"flex gap-2 sm:gap-3 justify-center flex-wrap mt-4",children:[(0,t.jsx)("button",{type:"button",onClick:r.handleNewProblem,className:"px-4 sm:px-5 lg:px-6 py-3 bg-green-600 hover:bg-green-700 active:bg-green-800 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",children:"manual"===r.inputMode?e.problemGenerator.findSolution:e.problemGenerator.newProblem}),(0,t.jsxs)("button",{type:"button",onClick:r.handleCopyUrl,disabled:0===r.solution.length,className:"px-4 sm:px-5 lg:px-6 py-3 bg-orange-600 hover:bg-orange-700 active:bg-orange-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",title:e.bookmark.urlCopied.replace("!",""),children:["ðŸ“‹ ",e.common.share]}),(0,t.jsx)("button",{type:"button",onClick:r.handleSaveBookmark,disabled:0===r.solution.length,className:"px-4 sm:px-5 lg:px-6 py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",title:e.bookmark.title,children:e.bookmark.save}),(0,t.jsx)("button",{type:"button",onClick:()=>r.setShowBookmarkSidebar(!0),className:"px-4 sm:px-5 lg:px-6 py-3 bg-purple-600 hover:bg-purple-700 active:bg-purple-800 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",title:e.bookmark.title,children:r.bookmarks.length>0?e.bookmark.listWithCount.replace("{count}",r.bookmarks.length.toString()):e.bookmark.list})]})]})]})}function Z(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen bg-zinc-900 flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-white text-xl",children:"Loading..."})}),children:(0,t.jsx)(A,{})})}e.s(["default",()=>Z],31713)}]);