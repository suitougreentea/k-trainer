(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,85440,(e,t,a)=>{t.exports=e.r(1893)},31713,e=>{"use strict";var t=e.i(63634),a=e.i(63410),l=e.i(2942);function s(){let{locale:e,setLocale:a}=(0,l.useI18n)();return(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("button",{type:"button",onClick:()=>a("ja"),className:`px-3 py-1.5 rounded transition-colors text-sm font-bold ${"ja"===e?"bg-blue-600 text-white":"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}`,children:"æ—¥æœ¬èªž"}),(0,t.jsx)("button",{type:"button",onClick:()=>a("en"),className:`px-3 py-1.5 rounded transition-colors text-sm font-bold ${"en"===e?"bg-blue-600 text-white":"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}`,children:"English"})]})}var r=e.i(85440);let o={I:1,O:2,T:3,S:4,Z:5,J:6,L:7},n={0:null,1:"I",2:"O",3:"T",4:"S",5:"Z",6:"J",7:"L"},i={I:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]],O:[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]],T:[[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]],S:[[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]],Z:[[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]],J:[[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,0,0,0],[1,1,1,0],[0,0,0,0]],[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]]],L:[[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]]]},c={I:i.I[0],O:i.O[0],T:i.T[0],S:i.S[0],Z:i.Z[0],J:i.J[0],L:i.L[0]};function d(e,t){return"O"===e?0:"I"===e||"S"===e||"Z"===e?t%2:t}function m(e){return"empty"===e?0:o[e]}function u(e){return 0===e?"empty":n[e]||"empty"}let x=["I","O","T","S","Z","J","L"],g={I:0,O:1,T:2,S:3,Z:4,J:5,L:6},p=["I","O","T","S","Z","J","L"];function h(e){return{verticalSplitGroups:e>>13&7,complexPlacements:e>>10&7,sonicDropReachable:(2&e)!=0,singleDropReachable:(1&e)!=0}}function b(e){let t=e.map(e=>g[e]);return 2401*t[0]+343*t[1]+49*t[2]+7*t[3]+t[4]}class f{buffer=null;indexTable=null;dataRegion=null;async load(e="/precomputed-patterns.pcdb"){let t;if("undefined"!=typeof Deno&&Deno.readFile){let a=e;if(e.startsWith("/")){let t=e.replace(/^\/k-trainer/,"");a=`./public${t}`}t=(await Deno.readFile(a)).buffer}else{let a="/k-trainer",l=e;e.startsWith(a)||(l=`${a}${e}`);let s=await fetch(l);if(!s.ok)throw Error(`Failed to load database: ${s.statusText}`);t=await s.arrayBuffer()}this.buffer=t;let a=new Uint8Array(this.buffer);if("PCDB"!==String.fromCharCode(a[0],a[1],a[2],a[3]))throw Error("Invalid database format");let l=new DataView(this.buffer,0,256);l.getUint32(4,!0);let s=l.getUint32(12,!0),r=l.getUint32(16,!0);this.indexTable=new DataView(this.buffer,s,134456),this.dataRegion=new DataView(this.buffer,r)}getSolutions(e,t={}){if(!this.indexTable||!this.dataRegion)throw Error("Database not loaded");let{dropMode:a="single",checkReachability:l=!0,sortByQuality:s=!0}=t,r=8*b(e),o=this.indexTable.getUint32(r,!0);if(0===this.indexTable.getUint32(r+4,!0))return null;let n=o,i=this.dataRegion.getUint16(n,!0);n+=2;let c=[];for(let t=0;t<i;t++){let t=h(this.dataRegion.getUint32(n,!0));n+=4;let s=this.dataRegion.getUint32(n,!0);n+=4;let r=this.dataRegion.getUint32(n,!0);n+=4;let o=BigInt(s)|BigInt(r)<<32n,i=[];for(let e=0;e<5;e++){let e=this.dataRegion.getUint16(n,!0);i.push(function(e){let t=e>>7&15;return t>=8&&(t-=16),{type:p[e>>13&7],rotation:e>>11&3,x:t,y:e>>3&15}}(e)),n+=2}let d=!0;l&&(d="single"===a?t.singleDropReachable:t.sonicDropReachable),d&&c.push({placements:i,sequence:e,quality:t,splitPatternHash:o})}return 0===c.length?null:(s&&c.sort((e,t)=>t.quality.verticalSplitGroups!==e.quality.verticalSplitGroups?t.quality.verticalSplitGroups-e.quality.verticalSplitGroups:e.quality.complexPlacements-t.quality.complexPlacements),c)}getSolutionCount(e,t={}){if(!this.indexTable||!this.dataRegion)throw Error("Database not loaded");let{dropMode:a="single",checkReachability:l=!0}=t,s=8*b(e),r=this.indexTable.getUint32(s,!0);if(0===this.indexTable.getUint32(s+4,!0))return 0;let o=r,n=this.dataRegion.getUint16(o,!0);o+=2;let i=0;for(let e=0;e<n;e++){let e=h(this.dataRegion.getUint32(o,!0));o+=22;let t=!0;l&&(t="single"===a?e.singleDropReachable:e.sonicDropReachable),t&&i++}return i}hasSolution(e,t={}){return this.getSolutionCount(e,t)>0}getUniqueSolutions(e,t={}){let a=this.getSolutions(e,t);if(!a)return null;let l=new Set,s=[];for(let e of a){let t=e.splitPatternHash?.toString()??"";l.has(t)||(l.add(t),s.push(e))}return s}}let k=null;async function y(e){k=new f,await k.load(e)}async function v(e,t){if(t.useDatabase){let a=function(e,t={}){if(!k)throw console.error("Database not loaded"),Error("Database not loaded");return k.getSolutions(e,t)}(e,{dropMode:t.dropMode,checkReachability:!1!==t.checkReachability,sortByQuality:!0}),l=a?a.slice(0,t.maxSolutions):[],s={totalNodes:0,solutionsFound:l.length,maxDepth:5*(l.length>0)};return{solutions:l,stats:s}}{let{solutions:a,stats:l}=await z(e,{maxSolutions:t.maxSolutions,checkReachability:t.checkReachability,dropMode:t.dropMode});return{solutions:a.map(t=>({placements:t.placements.map(T),sequence:e,initialHold:null,splitPatternHash:t.split_pattern_hash?function(e){if(8!==e.length)throw Error(`Expected 8 bytes, got ${e.length}`);let t=0n;for(let a=0;a<8;a++)t|=BigInt(e[a])<<BigInt(8*a);return t}(t.split_pattern_hash):void 0})),stats:{totalNodes:l.total_nodes,solutionsFound:l.solutions_found,maxDepth:l.max_depth_reached}}}}let j=null,N=!1;async function w(){if(!N||!j)try{if(j=await e.A(54778),"function"!=typeof j.find_perfect_clear_solutions)throw Error("WASM module is not properly initialized");N=!0}catch(e){throw console.error("[WASM INIT] Failed to initialize WASM:",e),e}}function S(e){return({I:0,O:1,T:2,S:3,Z:4,J:5,L:6})[e]}async function z(e,t={}){let{maxSolutions:a=1/0,checkReachability:l="staged",dropMode:s="sonic"}=t;if(N&&j||await w(),!j)throw Error("WASM module is not initialized");if(5!==e.length)throw Error(`Solver requires exactly 5 minos, got ${e.length}`);let r=new Uint8Array(e.map(S)),o=Number.isFinite(a)?Math.max(1,Math.floor(a)):0xffffffff,n=j.find_perfect_clear_solutions(r,o,+(!1!==l),+("single"!==s));return{solutions:n.solutions,stats:n.stats}}function T(e){return{type:e.mino_type,rotation:e.rotation,x:e.x,y:e.y}}async function C(e,t={}){let{initialHold:a=null,maxSolutions:l=1/0,checkReachability:s="staged",dropMode:r="sonic",includeStats:o=!1,useDatabase:n=!1,uniqueByHash:i=!1}=t;if(null!==a&&5===e.length){let t=function(e,t){let a=[],l=new Set;for(let s=0;s<32;s++){let r=[],o=[],n=e,i=0;for(let e=0;e<5&&((s&1<<e)!=0&&null!==n?(r.push(n),o.push(!0),n=t[i]):(r.push(t[i]),o.push(!1)),!(++i>5));e++);if(5===r.length){let e=r.join(",");l.has(e)||(l.add(e),a.push({sequence:r,holdFlags:o}))}}return a}(a,e),u=[],x={totalNodes:0,solutionsFound:0,maxDepth:0};for(let o of t){if(u.length>=l)break;let t=l-u.length,{solutions:i,stats:g}=await v(o.sequence,{dropMode:r,checkReachability:s,maxSolutions:t,useDatabase:n});for(let t of(x.totalNodes+=g.totalNodes,x.maxDepth=Math.max(x.maxDepth,g.maxDepth),i)){var c,d,m;if(u.length>=l)break;let s=(c=t,d=e,m=a,{...c,placements:c.placements,initialHold:m,originalSequence:[...d]});u.push(s)}}return(x.solutionsFound=u.length,await B(u),i&&I(u),o)?{solutions:u,stats:x}:u}let{solutions:u,stats:x}=await v(e,{dropMode:r,checkReachability:s,maxSolutions:l,useDatabase:n});return(n||await B(u),i&&I(u),o)?{solutions:u,stats:x}:u}async function D(e){if(N&&j||await w(),!j)throw Error("WASM module is not initialized");let t={placements:e.placements.map(e=>({mino_type:e.type,x:e.x,y:e.y,rotation:e.rotation})),sequence:e.sequence},a=j.evaluate_solution_quality_wasm(t);return{verticalSplitGroups:a.vertical_split_groups,complexPlacements:a.needs_complex_placement,sonicDropReachable:a.sonic_drop_reachable,singleDropReachable:a.single_drop_reachable}}function I(e){if(0===e.length)return;let t=new Set,a=[];for(let l of e){let e=l.splitPatternHash;if(void 0===e){a.push(l);continue}t.has(e)||(t.add(e),a.push(l))}e.splice(0,e.length,...a)}async function B(e){N&&j||await w();let t=await Promise.all(e.map(e=>D(e))),a=e.map(e=>(function(e){if(!e.sequence||0===e.sequence.length)return null;let t=e.initialHold;if(null==t)return null;let a=t,l=0,s=e.originalSequence||e.sequence;for(let t of e.placements){let e=t.type,r=s[l];if(e===a)a=r,l++;else{if(e!==r)return null;l++}}return a})(e)).map(e=>(function(e){if(null===e)return -1;switch(e){case"T":return 5;case"J":case"L":return 4;case"I":return 3;case"O":return 2;case"S":case"Z":return 1;default:return 0}})(e)),l=e.map((e,t)=>t);l.sort((e,l)=>{let s=t[e],r=t[l],o=a[e],n=a[l];return(o>=0||n>=0)&&n!==o?n-o:r.verticalSplitGroups!==s.verticalSplitGroups?r.verticalSplitGroups-s.verticalSplitGroups:s.complexPlacements-r.complexPlacements});let s=l.map(t=>e[t]);e.splice(0,e.length,...s)}let F="k-trainer-bookmarks",R="k-trainer-tags",M="k-trainer-bookmarks-backup",$="k-trainer-tags-backup";function P(e){let t=e.version||1;if(2===t)return e;if(1===t)return{...e,solution:e.solution.map(e=>({...e,y:e.y-5})),version:2};return console.warn(`Unknown bookmark version: ${t}`),e}let U=e=>{let t=["I","O","T","S","Z","J","L"];return e.toUpperCase().replace(/[^IOTSZJL]/g,"").split("").filter(e=>t.includes(e))},O={I:"bg-red-500",O:"bg-yellow-500",T:"bg-cyan-500",S:"bg-pink-500",Z:"bg-green-500",J:"bg-blue-500",L:"bg-orange-500",empty:"bg-zinc-800"},q=({type:e,size:a="normal"})=>{let l,s,r,o,n=c[e],i="small"===a?"w-3 h-3":"w-5 h-5",d=(l=4,s=-1,r=4,o=-1,n.forEach((e,t)=>{e.forEach((e,a)=>{e&&(l=Math.min(l,t),s=Math.max(s,t),r=Math.min(r,a),o=Math.max(o,a))})}),{minRow:l,maxRow:s,minCol:r,maxCol:o}),m=n.slice(d.minRow,d.maxRow+1).map(e=>e.slice(d.minCol,d.maxCol+1)),u=m[0].length;return(0,t.jsx)("div",{className:"grid gap-0.5",style:{gridTemplateColumns:`repeat(${u}, minmax(0, 1fr))`},children:m.flat().map((a,l)=>(0,t.jsx)("div",{className:`${i} ${a?O[e]:"bg-transparent"} ${a?"border border-black/20":""}`},l))})};function J({board:e}){return(0,t.jsx)("div",{className:"bg-black p-1 sm:p-2 rounded-lg border-2 sm:border-4 border-zinc-700",children:(0,t.jsx)("div",{className:"grid grid-rows-10 gap-0.5",children:e.map((e,a)=>(0,t.jsx)("div",{className:"flex gap-0.5",children:e.map((e,a)=>(0,t.jsx)("div",{className:`w-6 h-6 sm:w-10 sm:h-10 lg:w-12 lg:h-12 ${O[e]} ${"empty"===e?"border border-zinc-700":"border border-black"}`},a))},a))})})}function L({holdPiece:e}){let{t:a}=(0,l.useI18n)();return(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-2 sm:p-3 lg:p-4 rounded-lg border-2 border-zinc-700 w-20 sm:w-24 lg:w-28",children:[(0,t.jsx)("h2",{className:"text-white text-xs sm:text-sm font-bold mb-2 sm:mb-3 text-center",children:a.game.hold}),(0,t.jsx)("div",{className:"h-14 sm:h-16 lg:h-20 flex items-center justify-center",children:e?(0,t.jsx)(q,{type:e,size:"small"}):(0,t.jsx)("div",{className:"text-zinc-500 text-xs sm:text-sm text-center",children:"-"})})]})})}function A({nextMinos:e}){let{t:a}=(0,l.useI18n)();return(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-2 sm:p-3 lg:p-4 rounded-lg border-2 border-zinc-700 w-20 sm:w-24 lg:w-28",children:[(0,t.jsx)("h2",{className:"text-white text-xs sm:text-sm font-bold mb-2 sm:mb-3 text-center",children:a.game.nextLabel}),(0,t.jsx)("div",{className:"flex flex-col gap-1 sm:gap-1.5 lg:gap-2",children:[0,1,2,3,4].map(a=>(0,t.jsx)("div",{className:"h-12 sm:h-14 lg:h-16 flex items-center justify-center",children:e[a]?(0,t.jsx)(q,{type:e[a],size:"small"}):(0,t.jsx)("div",{className:"text-zinc-500 text-xs text-center",children:"-"})},a))})]})})}function E({onPrevStep:e,onNextStep:a,onReset:s,currentStep:r,solutionLength:o}){let{t:n}=(0,l.useI18n)();return(0,t.jsxs)("div",{className:"flex gap-2 sm:gap-3 lg:gap-4 items-stretch sm:items-center justify-center mb-3 sm:mb-4",children:[(0,t.jsx)("button",{type:"button",onClick:e,disabled:0===r,className:"flex-1 sm:flex-none px-4 sm:px-5 lg:px-6 py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",children:n.game.prev}),(0,t.jsx)("button",{type:"button",onClick:s,disabled:0===r,className:"px-3 sm:px-4 py-3 bg-zinc-700 hover:bg-zinc-600 active:bg-zinc-500 disabled:bg-zinc-800 disabled:text-zinc-600 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",children:n.common.reset}),(0,t.jsx)("button",{type:"button",onClick:a,disabled:r>=o,className:"flex-1 sm:flex-none px-4 sm:px-5 lg:px-6 py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",children:n.game.next})]})}function _({onPrevSolution:e,onNextSolution:a,currentSolutionIndex:s,allSolutionsLength:r}){let{t:o}=(0,l.useI18n)();return(0,t.jsx)("div",{className:"bg-zinc-800 p-3 rounded-lg border-2 border-zinc-700 mb-3 sm:mb-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:e,disabled:0===s||0===r,className:"px-3 py-2 bg-purple-600 hover:bg-purple-700 active:bg-purple-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm",children:o.game.prevSolution}),(0,t.jsx)("span",{className:"text-white text-sm font-bold",children:r>0?(0,t.jsxs)(t.Fragment,{children:[o.game.solution," ",s+1," / ",r]}):(0,t.jsxs)(t.Fragment,{children:[o.game.solution," 0 / 0"]})}),(0,t.jsx)("button",{type:"button",onClick:a,disabled:s>=r-1||0===r,className:"px-3 py-2 bg-purple-600 hover:bg-purple-700 active:bg-purple-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm",children:o.game.nextSolution})]})})}function G(e){let{t:a}=(0,l.useI18n)(),{inputMode:s,setInputMode:r,difficulty:o,setDifficulty:n,inputHold:i,setInputHold:c,inputNext:d,setInputNext:m,useDatabase:u,setUseDatabase:x,dropMode:g,setDropMode:p,checkReachability:h,setCheckReachability:b,uniqueByHash:f,setUniqueByHash:k,randomFromTag:y,setRandomFromTag:v,tags:j,bookmarks:N,getTagName:w}=e;return(0,t.jsxs)("details",{className:"bg-zinc-800 p-3 sm:p-4 lg:p-5 rounded-lg border-2 border-zinc-700 mb-3 sm:mb-4",children:[(0,t.jsx)("summary",{className:"text-white text-sm sm:text-base font-bold cursor-pointer hover:text-zinc-300 transition-colors select-none",children:a.options.title}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:gap-4 mt-3 sm:mt-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.problemGenerator.generationMode,":"]}),(0,t.jsx)("div",{className:"flex gap-3 sm:gap-4",children:["random","bookmark","manual"].map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:e,checked:s===e,onChange:e=>r(e.currentTarget.value),className:"w-4 h-4"}),(0,t.jsx)("span",{className:"text-white text-sm sm:text-base",children:a.problemGenerator[e]})]},e))})]}),"bookmark"===s&&(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsx)("div",{className:"text-white text-sm font-bold mb-2",children:a.problemGenerator.randomFromTag}),(0,t.jsx)("select",{value:y,onChange:e=>v(e.currentTarget.value),className:"w-full px-3 py-2 bg-zinc-700 text-white rounded border border-zinc-600 focus:border-blue-500 focus:outline-none text-sm sm:text-base",children:j.map(e=>(0,t.jsxs)("option",{value:e.id,children:[w(e)," (","default-all"===e.id?N.length:N.filter(t=>t.tags.includes(e.id)).length,")"]},e.id))})]}),"random"===s&&(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.problemGenerator.difficulty,":"]}),(0,t.jsx)("div",{className:"flex gap-3 sm:gap-4",children:["easy","hard"].map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:e,checked:o===e,onChange:e=>n(e.currentTarget.value),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm sm:text-base",children:[a.problemGenerator[e],(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.problemGenerator["easy"===e?"excludeSZ":"all7Types"]})]})]},e))})]}),"manual"===s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"text-white text-xs sm:text-sm mb-1 block",children:a.problemGenerator.holdInput}),(0,t.jsx)("input",{type:"text",value:i,onChange:e=>c(e.currentTarget.value),placeholder:a.problemGenerator.holdPlaceholder,className:"w-full px-3 py-2 bg-zinc-700 text-white rounded border border-zinc-600 focus:border-blue-500 focus:outline-none text-sm sm:text-base uppercase",maxLength:1})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"text-white text-xs sm:text-sm mb-1 block",children:a.problemGenerator.nextInput}),(0,t.jsx)("input",{type:"text",value:d,onChange:e=>m(e.currentTarget.value),placeholder:a.problemGenerator.nextPlaceholder,className:"w-full px-3 py-2 bg-zinc-700 text-white rounded border border-zinc-600 focus:border-blue-500 focus:outline-none text-sm sm:text-base uppercase font-mono",maxLength:10})]})]}),(0,t.jsx)("div",{className:"text-zinc-400 text-xs",children:a.problemGenerator.validMinos})]}),(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.options.solutionMethod,":"]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:"database",checked:u,onChange:()=>x(!0),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-sm text-white",children:[a.options.database,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.databaseFast})]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:"solver",checked:!u,onChange:()=>x(!1),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.solver,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.solverHold})]})]})]})]}),(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.options.dropMode,":"]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[(0,t.jsxs)("label",{className:`flex items-center gap-2 ${"staged"===h?"cursor-pointer":"cursor-not-allowed opacity-50"}`,children:[(0,t.jsx)("input",{type:"radio",value:"sonic",checked:"sonic"===g,onChange:()=>p("sonic"),className:"w-4 h-4",disabled:"staged"!==h}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.sonicDrop,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.sonicFast})]})]}),(0,t.jsxs)("label",{className:`flex items-center gap-2 ${"staged"===h?"cursor-pointer":"cursor-not-allowed opacity-50"}`,children:[(0,t.jsx)("input",{type:"radio",value:"single",checked:"single"===g,onChange:()=>p("single"),className:"w-4 h-4",disabled:"staged"!==h}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.singleMove,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.singleDebug})]})]})]})]}),(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.options.additionalSettings,":"]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4 pl-2",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:!1===h,onChange:e=>{b(!e.currentTarget.checked&&"staged")},className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.disableReachabilityCheck,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.includesInvalid})]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:f,onChange:e=>{k(e.currentTarget.checked)},className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.uniqueByHash,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.showAllVariations})]})]})]})]})]})]})}function H(e){let{t:s}=(0,l.useI18n)(),{show:r,onClose:o,bookmarks:n,tags:i,onLoadBookmark:c,getTagName:d,getTagColorClass:m,selectedFilterTag:u,setSelectedFilterTag:x,clearBookmarks:g,deleteBookmark:p,addTag:h,renameTag:b,deleteTag:f,addTagToBookmark:k,removeTagFromBookmark:y,exportBookmarks:v,importBookmarks:j,restoreFromBackup:N,getBackupInfo:w,clearBackup:S}=e,[z,T]=(0,a.useState)(!1),[C,D]=(0,a.useState)(null),[I,B]=(0,a.useState)({exists:!1});return(0,a.useState)(()=>{B(w())}),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:`fixed top-0 right-0 h-full bg-zinc-800 border-l-2 border-zinc-700 transition-transform duration-300 z-40 ${r?"translate-x-0":"translate-x-full"} w-80 sm:w-96 overflow-y-auto`,children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4 sticky top-0 bg-zinc-800 pb-2 border-b border-zinc-700",children:[(0,t.jsx)("h3",{className:"text-white text-lg font-bold",children:s.bookmark.title}),(0,t.jsx)("button",{type:"button",onClick:o,className:"px-3 py-1.5 bg-zinc-600 hover:bg-zinc-700 text-white text-sm rounded transition-colors",children:s.bookmark.close})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("div",{className:"text-white text-sm font-bold mb-2",children:s.bookmark.filterByTag}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:i.map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>x(e.id),className:`px-2 py-1 rounded text-xs transition-all ${u===e.id?`${m(e.color)} text-white font-bold`:"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}`,children:[d(e),(0,t.jsxs)("span",{className:"ml-1 text-xs",children:["(","default-all"===e.id?n.length:n.filter(t=>t.tags.includes(e.id)).length,")"]})]},e.id))})]}),(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("button",{type:"button",onClick:()=>T(!z),className:"w-full px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded transition-colors",children:z?s.bookmark.closeTagManagement:s.bookmark.tagManagement})}),(0,t.jsxs)("div",{className:"mb-3 flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{try{let e=v(),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`konoha-trainer-bookmarks-${new Date().toISOString().slice(0,10)}.json`,l.click(),URL.revokeObjectURL(a)}catch(e){alert(`Export failed: ${e}`)}},className:"flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-sm rounded transition-colors",children:"ðŸ“¥ Export"}),(0,t.jsx)("button",{type:"button",onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="application/json",e.onchange=async e=>{let t=e.target.files?.[0];if(t)try{let e=await t.text(),a=j(e);if(a.success){let e=`Successfully imported ${a.imported} bookmarks`;a.migrated&&(e+=`
(${a.migrated} bookmarks were migrated from old version)`),alert(e)}else alert(`Import failed: ${a.error}`)}catch(e){alert(`Import failed: ${e}`)}},e.click()},className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded transition-colors",children:"ðŸ“¤ Import"})]}),I.exists&&(0,t.jsxs)("div",{className:"mb-3 p-3 bg-yellow-900/30 border border-yellow-700 rounded-lg",children:[(0,t.jsx)("div",{className:"text-yellow-300 text-xs font-bold mb-2",children:"ðŸ”„ Backup Available"}),(0,t.jsxs)("div",{className:"text-yellow-200 text-xs mb-2",children:[I.count," bookmarks (v",I.originalVersion,")",(0,t.jsx)("br",{}),I.backedUpAt&&(0,t.jsx)("span",{className:"text-yellow-400",children:new Date(I.backedUpAt).toLocaleString("ja-JP")})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{if(!confirm("Restore bookmarks from backup? This will replace your current bookmarks."))return;let e=N();e.success?(alert(`Successfully restored ${e.restored} bookmarks from backup`),B(w())):alert(`Restore failed: ${e.error}`)},className:"flex-1 px-2 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs rounded transition-colors",children:"Restore"}),(0,t.jsx)("button",{type:"button",onClick:()=>{confirm("Delete backup? This cannot be undone.")&&(S()?(B({exists:!1}),alert("Backup deleted successfully")):alert("Failed to delete backup"))},className:"flex-1 px-2 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition-colors",children:"Delete"})]})]}),z&&(0,t.jsxs)("div",{className:"mb-4 p-3 bg-zinc-700 rounded-lg border border-zinc-600",children:[(0,t.jsx)("div",{className:"text-white text-sm font-bold mb-3",children:s.bookmark.manageTagsTitle}),(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("button",{type:"button",onClick:()=>{let e=prompt(s.bookmark.enterTagName);if(e?.trim()){let t=["red","orange","yellow","green","blue","purple","pink"];h(e.trim(),t[Math.floor(Math.random()*t.length)])}},className:"w-full px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-xs rounded transition-colors",children:s.bookmark.addNewTag})}),(0,t.jsxs)("div",{className:"space-y-2",children:[i.filter(e=>!e.isDefault).map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-zinc-800 rounded",children:[(0,t.jsx)("span",{className:`flex-1 px-2 py-1 rounded text-xs ${m(e.color)} text-white`,children:d(e)}),(0,t.jsx)("button",{type:"button",onClick:()=>{let t=prompt(s.bookmark.enterNewName,e.name);t?.trim()&&b(e.id,t.trim())},className:"px-2 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors",title:s.bookmark.rename,children:"âœŽ"}),(0,t.jsx)("button",{type:"button",onClick:()=>{confirm(s.bookmark.confirmDeleteTag.replace("{name}",e.name))&&f(e.id)},className:"px-2 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition-colors",title:s.common.delete,children:"âœ•"})]},e.id)),0===i.filter(e=>!e.isDefault).length&&(0,t.jsx)("div",{className:"text-zinc-500 text-xs text-center py-2",children:s.bookmark.noCustomTags})]})]}),0===n.length?(0,t.jsx)("div",{className:"text-zinc-500 text-center py-12 text-sm",children:"default-all"===u?s.bookmark.empty:s.bookmark.emptyFiltered}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mb-3 flex justify-end",children:(0,t.jsx)("button",{type:"button",onClick:()=>{confirm(s.bookmark.confirmDeleteAll)&&g()},className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition-colors",children:s.bookmark.deleteAll})}),(0,t.jsx)("div",{className:"space-y-2",children:n.map(e=>(0,t.jsx)("div",{className:"bg-zinc-700 p-3 rounded-lg border border-zinc-600 hover:border-zinc-500 transition-colors",children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"text-white font-bold text-sm break-words",children:e.name}),(0,t.jsxs)("div",{className:"text-zinc-400 text-xs font-mono",children:[e.holdPiece&&`[${e.holdPiece}] `,e.sequence.join("")]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("div",{className:"text-zinc-500 text-xs",children:new Date(e.createdAt).toLocaleString("ja-JP")}),e.version&&(0,t.jsxs)("div",{className:"text-zinc-600 text-xs font-mono",children:["v",e.version]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-1 items-center",children:[e.tags.map(a=>{let l=i.find(e=>e.id===a);return l?(0,t.jsxs)("span",{className:`px-2 py-0.5 rounded text-xs ${m(l.color)} text-white flex items-center gap-1`,children:[d(l),(0,t.jsx)("button",{type:"button",onClick:t=>{t.stopPropagation(),y(e.id,a)},className:"hover:text-red-300",title:s.bookmark.removeTag,children:"âœ•"})]},a):null}),(0,t.jsx)("button",{type:"button",onClick:()=>D(C===e.id?null:e.id),className:"px-2 py-0.5 bg-zinc-600 hover:bg-zinc-500 text-white text-xs rounded transition-colors",title:s.bookmark.addTagTooltip,children:"ï¼‹"})]}),C===e.id&&(0,t.jsxs)("div",{className:"p-2 bg-zinc-800 rounded border border-zinc-600",children:[(0,t.jsxs)("div",{className:"text-white text-xs mb-2",children:[s.bookmark.addTag,":"]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[i.filter(t=>!t.isDefault&&!e.tags.includes(t.id)).map(a=>(0,t.jsx)("button",{type:"button",onClick:()=>{k(e.id,a.id),D(null)},className:`px-2 py-1 rounded text-xs ${m(a.color)} text-white hover:opacity-80 transition-opacity`,children:d(a)},a.id)),0===i.filter(t=>!t.isDefault&&!e.tags.includes(t.id)).length&&(0,t.jsx)("div",{className:"text-zinc-500 text-xs",children:s.bookmark.noTagsToAdd})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,t.jsx)("button",{type:"button",onClick:()=>c(e),className:"flex-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded transition-colors",children:s.bookmark.load}),(0,t.jsx)("button",{type:"button",onClick:()=>{confirm(s.bookmark.confirmDelete.replace("{name}",e.name))&&p(e.id)},className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-sm rounded transition-colors",children:s.common.delete})]})]})},e.id))})]})]})}),r&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-30",onClick:o})]})}function Z(e){let{t:a}=(0,l.useI18n)(),{show:s,onClose:r,onConfirm:o,tags:n,selectedTags:i,onToggleTag:c,getTagName:d,getTagColorClass:m}=e;return s?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-6 rounded-lg border-2 border-zinc-700 max-w-md w-full",children:[(0,t.jsx)("h3",{className:"text-white text-lg font-bold mb-4",children:a.bookmark.selectTags}),(0,t.jsxs)("div",{className:"mb-4 max-h-60 overflow-y-auto",children:[n.filter(e=>!e.isDefault).map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-2 p-2 hover:bg-zinc-700 rounded cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:i.includes(e.id),onChange:()=>c(e.id),className:"w-4 h-4"}),(0,t.jsx)("span",{className:`px-2 py-1 rounded text-xs ${m(e.color)} text-white`,children:d(e)})]},e.id)),0===n.filter(e=>!e.isDefault).length&&(0,t.jsx)("div",{className:"text-zinc-500 text-sm text-center py-4",children:a.bookmark.noTags})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:a.common.save}),(0,t.jsx)("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2 bg-zinc-600 hover:bg-zinc-700 text-white rounded transition-colors",children:a.common.cancel})]})]})}):null}function W({show:e,message:a}){let{t:s}=(0,l.useI18n)();return e?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-6 sm:p-8 rounded-lg border-2 border-zinc-700 text-center max-w-md mx-4",children:[(0,t.jsx)("div",{className:"text-white text-lg sm:text-xl mb-4",children:a||s.common.initializing}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})})]})}):null}function V({error:e,onClose:a}){let{t:s}=(0,l.useI18n)();return e?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-6 sm:p-8 rounded-lg border-2 border-zinc-700 text-center max-w-md mx-4",children:[(0,t.jsx)("div",{className:"text-red-500 text-lg sm:text-xl mb-4",children:e}),(0,t.jsx)("button",{type:"button",onClick:a,className:"px-6 py-3 bg-zinc-600 hover:bg-zinc-700 text-white rounded-lg font-bold transition-colors",children:s.common.close})]})}):null}function K(){let{t:e}=(0,l.useI18n)(),o=function(){var e,t;let s,o=(0,r.useSearchParams)(),n=(0,r.useRouter)(),{t:g}=(0,l.useI18n)(),[p,h]=(0,a.useState)([]),[b,f]=(0,a.useState)(null),[k,v]=(0,a.useState)([]),[j,N]=(0,a.useState)(0),[S,z]=(0,a.useState)([]),[T,D]=(0,a.useState)(0),[I,B]=(0,a.useState)(!1),[O,q]=(0,a.useState)(""),[J,L]=(0,a.useState)(""),[A,E]=(0,a.useState)(!1),[_,G]=(0,a.useState)(!1),[H,Z]=(0,a.useState)("random"),[W,V]=(0,a.useState)(""),[K,Q]=(0,a.useState)(""),[X,Y]=(0,a.useState)("hard"),[ee,et]=(0,a.useState)(!0),[ea,el]=(0,a.useState)("staged"),[es,er]=(0,a.useState)("sonic"),[eo,en]=(0,a.useState)(!1),ei=function(){let{t:e}=(0,l.useI18n)(),t=[{id:"default-all",name:e.common.all,color:"gray",isDefault:!0}],[s,r]=(0,a.useState)([]),[o,n]=(0,a.useState)(t);(0,a.useEffect)(()=>{try{let e=localStorage.getItem(F);if(e){let t=JSON.parse(e),a=t.some(e=>2!==(e.version||1));if(a)try{let e={bookmarks:t,backedUpAt:Date.now(),originalVersion:t[0]?.version||1};localStorage.setItem(M,JSON.stringify(e)),console.log(`Backed up ${t.length} bookmarks before migration`);let a=localStorage.getItem(R);a&&localStorage.setItem($,a)}catch(e){console.error("Failed to backup bookmarks:",e)}let l=t.map(e=>{let t={...e,tags:e.tags||[]};return P(t)});r(l),a&&(localStorage.setItem(F,JSON.stringify(l)),console.log(`Migrated ${l.length} bookmarks to version 2`))}let a=localStorage.getItem(R);if(a){let e=JSON.parse(a).filter(e=>!e.isDefault);n([...t,...e])}}catch(e){console.error("Failed to load bookmarks:",e)}},[]);let i=e=>{try{localStorage.setItem(F,JSON.stringify(e)),r(e)}catch(e){console.error("Failed to save bookmarks:",e)}},c=e=>{try{let t=e.filter(e=>!e.isDefault);localStorage.setItem(R,JSON.stringify(t)),n(e)}catch(e){console.error("Failed to save tags:",e)}};return{bookmarks:s,tags:o,addBookmark:(e,t,a,l,r=[])=>{try{let o,n=s.find(e=>{var l,s;return l=e.sequence,s=e.holdPiece,l.length===t.length&&s===a&&l.every((e,a)=>e===t[a])});if(n)o=s.map(t=>t.id===n.id?{...t,name:e,solution:l,tags:r,version:2}:t);else{let n={id:Date.now().toString(),name:e,sequence:t,holdPiece:a,solution:l,createdAt:Date.now(),tags:r,version:2};o=[...s,n]}return i(o),!0}catch(e){return console.error("Failed to add bookmark:",e),!1}},deleteBookmark:e=>{i(s.filter(t=>t.id!==e))},clearBookmarks:()=>{i([])},addTag:(e,t)=>{try{let a={id:`tag-${Date.now()}`,name:e,color:t,isDefault:!1},l=[...o,a];return c(l),!0}catch(e){return console.error("Failed to add tag:",e),!1}},deleteTag:e=>{let t=o.find(t=>t.id===e);if(t?.isDefault)return console.error("Cannot delete default tag"),!1;try{let t=o.filter(t=>t.id!==e);c(t);let a=s.map(t=>({...t,tags:t.tags.filter(t=>t!==e)}));return i(a),!0}catch(e){return console.error("Failed to delete tag:",e),!1}},renameTag:(e,t)=>{let a=o.find(t=>t.id===e);if(a?.isDefault)return console.error("Cannot rename default tag"),!1;try{let a=o.map(a=>a.id===e?{...a,name:t}:a);return c(a),!0}catch(e){return console.error("Failed to rename tag:",e),!1}},changeTagColor:(e,t)=>{let a=o.find(t=>t.id===e);if(a?.isDefault)return console.error("Cannot change default tag color"),!1;try{let a=o.map(a=>a.id===e?{...a,color:t}:a);return c(a),!0}catch(e){return console.error("Failed to change tag color:",e),!1}},addTagToBookmark:(e,t)=>{try{let a=s.map(a=>a.id!==e||a.tags.includes(t)?a:{...a,tags:[...a.tags,t]});return i(a),!0}catch(e){return console.error("Failed to add tag to bookmark:",e),!1}},removeTagFromBookmark:(e,t)=>{try{let a=s.map(a=>a.id===e?{...a,tags:a.tags.filter(e=>e!==t)}:a);return i(a),!0}catch(e){return console.error("Failed to remove tag from bookmark:",e),!1}},getRandomBookmarkByTag:e=>{let t="default-all"===e?s:s.filter(t=>t.tags.includes(e));if(0===t.length)return null;let a=Math.floor(Math.random()*t.length);return t[a]},exportBookmarks:()=>JSON.stringify({bookmarks:s,tags:o.filter(e=>!e.isDefault),exportedAt:Date.now(),version:2},null,2),importBookmarks:e=>{try{let a=JSON.parse(e);if(!a.bookmarks||!Array.isArray(a.bookmarks))return{success:!1,error:"Invalid data format: bookmarks array not found"};let l=a.bookmarks.map(e=>P(e)),r=a.bookmarks.filter(e=>2!==(e.version||1)).length;s.map(e=>e.id);let n=[...s];for(let e of l){let t=n.findIndex(t=>t.id===e.id);t>=0?n[t]=e:n.push(e)}if(i(n),a.tags&&Array.isArray(a.tags)){let e=o.filter(e=>!e.isDefault),l=new Set(e.map(e=>e.id)),s=[...e];for(let e of a.tags)l.has(e.id)||e.isDefault||s.push(e);c([...t,...s])}return{success:!0,imported:l.length,migrated:r>0?r:void 0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}},restoreFromBackup:()=>{try{let e=localStorage.getItem(M);if(!e)return{success:!1,error:"No backup found"};let a=JSON.parse(e);if(!a.bookmarks||!Array.isArray(a.bookmarks))return{success:!1,error:"Invalid backup data format"};let l=a.bookmarks.map(e=>({...e,tags:e.tags||[]}));r(l),localStorage.setItem(F,JSON.stringify(l));let s=localStorage.getItem($);if(s){let e=JSON.parse(s).filter(e=>!e.isDefault),a=[...t,...e];n(a),c(a)}return{success:!0,restored:l.length}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}},getBackupInfo:()=>{try{let e=localStorage.getItem(M);if(!e)return{exists:!1};let t=JSON.parse(e);return{exists:!0,count:t.bookmarks?.length,backedUpAt:t.backedUpAt,originalVersion:t.originalVersion}}catch(e){return{exists:!1}}},clearBackup:()=>{try{return localStorage.removeItem(M),localStorage.removeItem($),!0}catch(e){return console.error("Failed to clear backup:",e),!1}}}}(),[ec,ed]=(0,a.useState)(!1),[em,eu]=(0,a.useState)(!1),[ex,eg]=(0,a.useState)([]),[ep,eh]=(0,a.useState)("default-all"),[eb,ef]=(0,a.useState)("default-all"),[ek,ey]=(0,a.useState)(!1),[ev,ej]=(0,a.useState)(null),[eN,ew]=(0,a.useState)(!0),[eS,ez]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{q(g.common.initializing),await w(),E(!0);try{q(g.common.loadingDatabase),await y("/precomputed-patterns.pcdb"),G(!0)}catch(e){console.warn("DB load failed, solver mode:",e),G(!1)}finally{ez(!0)}}catch(e){L("WASMã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(e instanceof Error?e.message:String(e))),ez(!0)}})()},[g.common.initializing,g.common.loadingDatabase]);let eT=(0,a.useCallback)(async(e,t)=>{if(A){B(!0),q("å•é¡Œã‚’ç”Ÿæˆä¸­..."),L(""),await new Promise(e=>setTimeout(e,0));try{let a=await C(e,{initialHold:t,checkReachability:ea,dropMode:es,useDatabase:ee&&_,uniqueByHash:!eo});if(a.length>0){let l=a.map(e=>e.placements);v(l),N(0),h(e),f(t),z(l[0]),D(0)}else L(g.error.noSolution)}catch(e){L("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+(e instanceof Error?e.message:String(e)))}finally{B(!1)}}},[A,ee,_,es,ea,eo,g.error.noSequenceInDatabase,g.error.noSolution]);(0,a.useEffect)(()=>{if(!A||!eN||!eS)return;let e=o.get("hold"),t=o.get("next"),a=o.get("mode"),l=o.get("reach"),s=o.get("drop");o.get("bitboard");let r=o.get("db"),n=o.get("difficulty"),i=o.get("nomerge");if("manual"===a?Z("manual"):Z("random"),"easy"===n?Y("easy"):Y("hard"),"false"===r?et(!1):et(!0),"false"===l?el(!1):el("staged"),"single"===s?er("single"):er("sonic"),"true"===i?en(!0):en(!1),t){let l=U(t);5===l.length&&("manual"===a&&(Q(t.toUpperCase()),e&&U(e).length<=1&&V(e.toUpperCase())),setTimeout(()=>{eT(l,e?U(e)[0]:null)},100))}ew(!1)},[A,eN,eS,o,eT]);let eC=(0,a.useCallback)((e,t,a,l,s,r,o,i)=>{let c=new URLSearchParams;5===e.length&&(c.set("next",e.join("")),t&&c.set("hold",t),"manual"===a&&c.set("mode","manual")),"staged"!==l&&c.set("reach",String(l)),"sonic"!==s&&c.set("drop",s),!0!==r&&c.set("db",String(r)),"hard"!==o&&c.set("difficulty",o),i&&c.set("nomerge","true");let d=c.toString()?`?${c.toString()}`:"/";n.push(d,{scroll:!1})},[n]),eD=(0,a.useCallback)(async e=>{h(e.sequence),f(e.holdPiece),z(e.solution),D(0),B(!0);try{let t=await C(e.sequence,{initialHold:e.holdPiece,checkReachability:ea,dropMode:es,useDatabase:ee&&_,uniqueByHash:!eo});if(t.length>0){let a=t.map(e=>e.placements);v(a);let l=a.findIndex(t=>JSON.stringify(t)===JSON.stringify(e.solution));N(-1!==l?l:0)}else v([e.solution]),N(0)}catch(t){console.error("Failed to recalculate solutions:",t),v([e.solution]),N(0)}finally{B(!1)}eC(e.sequence,e.holdPiece,H,ea,es,ee,X,eo)},[ei.bookmarks,ee,_,ea,es,eo,eC,H,X]),eI=(0,a.useCallback)(async()=>{if(!A)return void L(g.error.wasmInit);B(!0),q(g.problemGenerator.generating),L(""),await new Promise(e=>setTimeout(e,0));try{if("bookmark"===H){let e=ei.getRandomBookmarkByTag(eb);if(e)await eD(e);else{let e=ei.tags.find(e=>e.id===eb),t=e?eP(e):g.common.all;L(g.error.noBookmarkInTag.replace("{tag}",t))}B(!1);return}let e=[],t=null,a=[];if("manual"===H){let l=U(W),s=U(K);if(5!==s.length){L(g.error.nextRequired.replace("{count}",String(s.length))),B(!1);return}if(l.length>1){L(g.error.holdRequired.replace("{count}",String(l.length))),B(!1);return}e=s,t=1===l.length?l[0]:null;let r=await C(e,{initialHold:t,checkReachability:ea,dropMode:es,useDatabase:ee&&_,uniqueByHash:!eo});if(r.length>0){let e=r.map(e=>e.placements);v(e),N(0),a=e[0]}else L(g.error.noSolution)}else{let l=0;for(;0===a.length&&l<10;){l++,q(`${g.problemGenerator.generating} (${l}${g.problemGenerator.attempt})`),l%5==0&&await new Promise(e=>setTimeout(e,0));let{sequence:s,hold:r}=function(e="hard"){let t=function(e="hard"){let t=[..."easy"===e?["J","J","L","L"]:["Z","Z","S","S"]],a=[];for(let l=0;l<10;l++){let{mino:l,newHistory:s}=function(e,t="hard"){let a=null,l="easy"===t?x.filter(e=>"S"!==e&&"Z"!==e):x;for(let t=0;t<6;t++){let s=Math.floor(Math.random()*l.length),r=l[s];if(!e.includes(r)){a=r;break}5===t&&(a=r)}let s=[a,...e.slice(0,3)];return{mino:a,newHistory:s}}(t,e);a.push(l),t=s}return a}(e),a=t[4];return{sequence:t.slice(5,10),hold:a}}(X);e=s,t=r;let o=await C(e,{initialHold:t,checkReachability:ea,dropMode:es,useDatabase:ee&&_,uniqueByHash:!eo});if(o.length>0){let e=o.map(e=>e.placements);v(e),N(0),a=e[0]}}0===a.length&&L(g.error.attempts)}a.length>0&&(h(e),f(t),z(a),D(0),eC(e,t,H,ea,es,ee,X,eo))}catch(e){L("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+(e instanceof Error?e.message:String(e)))}finally{B(!1)}},[A,g,H,ei,eb,eD,W,K,ee,_,es,ea,eo,X,eC]),eB=S.length>0?(e=S.slice(0,T),s=[,,,,,].fill(null).map(()=>[,,,,,].fill("empty")),e.forEach((e,t)=>{t>0&&(s=(function(e){let t=[];for(let a=0;a<5;a++){let l=e[a];l.every(e=>0!==e)||t.push([...l])}let a=5-t.length;for(let e=0;e<a;e++)t.unshift([,,,,,].fill(0));return t})(s.map(e=>e.map(m))).map(e=>e.map(u)));let a=e.type;(function(e,t,a){if(a){let e=d(a,t);return i[a][e]}for(let a of Object.keys(c))if(JSON.stringify(c[a])===JSON.stringify(e)){let e=d(a,t);return i[a][e]}return e})(c[a],e.rotation,a).forEach((t,l)=>{t.forEach((t,r)=>{if(t){let t=e.y+l,o=e.x+r;t>=0&&t<5&&o>=0&&o<5&&(s[t][o]=a)}})})}),t=s,[...[,,,,,].fill(null).map(()=>[,,,,,].fill("empty")),...t]):Array(10).fill(null).map(()=>[,,,,,].fill("empty")),eF=(()=>{if(0===S.length||0===T)return b;if(null===b)return null;let e=b,t=0;for(let a=0;a<T;a++){let l=S[a].type,s=p[t];if(l===e)e=s,t++;else{if(l!==s)return console.warn(`Mismatch at step ${a}: placed=${l}, expected=${s}, hold=${e}`),b;t++}}return e})(),eR=p.slice(T),eM=async()=>{try{await navigator.clipboard.writeText(window.location.href),alert(g.bookmark.urlCopied)}catch(e){console.error("Failed to copy to clipboard:",e),alert(g.bookmark.urlCopyFailed)}},e$=ei.bookmarks.filter(e=>"default-all"===ep||e.tags.includes(ep)),eP=e=>"default-all"===e.id?g.common.all:e.name;return{sequence:p,holdPiece:b,allSolutions:k,currentSolutionIndex:j,solution:S,currentStep:T,isLoading:I,loadingMessage:O,error:J,wasmInitialized:A,isDatabaseInitialized:eS,inputMode:H,inputHold:W,inputNext:K,difficulty:X,useDatabase:ee,checkReachability:ea,dropMode:es,uniqueByHash:eo,randomFromTag:eb,board:eB,currentHold:eF,nextMinos:eR,showBookmarkSidebar:ec,showSaveModal:em,selectedTagsForSave:ex,selectedFilterTag:ep,showTagEditor:ek,editingBookmarkId:ev,filteredBookmarks:e$,setSequence:h,setHoldPiece:f,setAllSolutions:v,setCurrentSolutionIndex:N,setSolution:z,setCurrentStep:D,setIsLoading:B,setLoadingMessage:q,setError:L,setWasmInitialized:E,setDatabaseLoaded:G,setInputMode:Z,setInputHold:V,setInputNext:Q,setDifficulty:Y,setUseDatabase:et,setCheckReachability:el,setDropMode:er,setUniqueByHash:en,setShowBookmarkSidebar:ed,setShowSaveModal:eu,setSelectedTagsForSave:eg,setSelectedFilterTag:eh,setRandomFromTag:ef,setShowTagEditor:ey,setEditingBookmarkId:ej,handlePrevStep:()=>D(e=>Math.max(0,e-1)),handleNextStep:()=>D(e=>Math.min(S.length,e+1)),handleReset:()=>D(0),handlePrevSolution:()=>{if(j>0){let e=j-1;N(e),z(k[e]),D(0)}},handleNextSolution:()=>{if(j<k.length-1){let e=j+1;N(e),z(k[e]),D(0)}},handleNewProblem:()=>eI(),handleCopyUrl:eM,handleSaveBookmark:()=>{if(0===S.length)return void alert(g.bookmark.failed);let e=ei.bookmarks.find(e=>JSON.stringify(e.sequence)===JSON.stringify(p)&&e.holdPiece===b);eu(!0),eg(e?e.tags:[])},confirmSaveBookmark:()=>{if(0===S.length)return;let e=b?`[${b}] ${p.join("")}`:p.join(""),t=new Date().toLocaleString("ja-JP",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),a=`${e} (${t})`;ei.addBookmark(a,p,b,S,ex)?(alert(g.bookmark.saved),eu(!1),eg([])):alert(g.bookmark.failed)},toggleTagForSave:e=>{eg(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},handleLoadBookmark:eD,getTagName:eP,getTagColorClass:e=>({gray:"bg-gray-600",red:"bg-red-600",orange:"bg-orange-600",yellow:"bg-yellow-600",green:"bg-green-600",blue:"bg-blue-600",purple:"bg-purple-600",pink:"bg-pink-600"})[e]||"bg-gray-600",...ei}}();return(0,t.jsxs)("div",{className:"min-h-screen bg-zinc-900 font-sans p-2 sm:p-4 relative flex",children:[(0,t.jsx)(W,{show:!o.wasmInitialized||!o.isDatabaseInitialized,message:o.loadingMessage||e.common.initializing}),(0,t.jsx)(V,{error:o.error,onClose:()=>o.setError("")}),(0,t.jsx)(Z,{show:o.showSaveModal,onClose:()=>{o.setShowSaveModal(!1),o.setSelectedTagsForSave([])},onConfirm:o.confirmSaveBookmark,tags:o.tags,selectedTags:o.selectedTagsForSave,onToggleTag:o.toggleTagForSave,getTagName:o.getTagName,getTagColorClass:o.getTagColorClass}),(0,t.jsx)(H,{show:o.showBookmarkSidebar,onClose:()=>o.setShowBookmarkSidebar(!1),bookmarks:o.filteredBookmarks,tags:o.tags,onLoadBookmark:o.handleLoadBookmark,getTagName:o.getTagName,getTagColorClass:o.getTagColorClass,selectedFilterTag:o.selectedFilterTag,setSelectedFilterTag:o.setSelectedFilterTag,clearBookmarks:o.clearBookmarks,deleteBookmark:o.deleteBookmark,addTag:o.addTag,renameTag:o.renameTag,deleteTag:o.deleteTag,addTagToBookmark:o.addTagToBookmark,removeTagFromBookmark:o.removeTagFromBookmark,exportBookmarks:o.exportBookmarks,importBookmarks:o.importBookmarks,restoreFromBackup:o.restoreFromBackup,getBackupInfo:o.getBackupInfo,clearBackup:o.clearBackup}),(0,t.jsxs)("div",{className:"flex-1 max-w-6xl mx-auto w-full",children:[(0,t.jsx)(W,{show:o.isLoading,message:o.loadingMessage}),(0,t.jsx)("div",{className:"flex justify-end mb-3",children:(0,t.jsx)(s,{})}),(0,t.jsxs)("div",{className:"text-center mb-3 sm:mb-4",children:[(0,t.jsx)("h1",{className:"text-white text-xl sm:text-2xl font-bold mb-1 sm:mb-2",children:e.common.appTitle}),(0,t.jsx)("div",{className:"text-zinc-400 text-xs sm:text-sm",children:o.solution.length>0?(0,t.jsxs)(t.Fragment,{children:[e.game.step,": ",o.currentStep," / ",o.solution.length,o.currentStep===o.solution.length&&(0,t.jsxs)("span",{className:"ml-2 sm:ml-4 text-green-500 font-bold",children:["âœ“ ",e.game.complete]})]}):(0,t.jsx)("span",{children:e.game.clickToStart})})]}),(0,t.jsxs)("div",{className:"flex gap-2 sm:gap-4 lg:gap-6 items-start justify-center mb-3 sm:mb-4 overflow-x-auto",children:[(0,t.jsx)(L,{holdPiece:o.currentHold}),(0,t.jsx)(J,{board:o.board}),(0,t.jsx)(A,{nextMinos:o.nextMinos})]}),(0,t.jsx)(_,{onPrevSolution:o.handlePrevSolution,onNextSolution:o.handleNextSolution,currentSolutionIndex:o.currentSolutionIndex,allSolutionsLength:o.allSolutions.length}),(0,t.jsx)(E,{onPrevStep:o.handlePrevStep,onNextStep:o.handleNextStep,onReset:o.handleReset,currentStep:o.currentStep,solutionLength:o.solution.length}),(0,t.jsx)(G,{inputMode:o.inputMode,setInputMode:o.setInputMode,difficulty:o.difficulty,setDifficulty:o.setDifficulty,inputHold:o.inputHold,setInputHold:o.setInputHold,inputNext:o.inputNext,setInputNext:o.setInputNext,useDatabase:o.useDatabase,setUseDatabase:o.setUseDatabase,dropMode:o.dropMode,setDropMode:o.setDropMode,checkReachability:o.checkReachability,setCheckReachability:o.setCheckReachability,uniqueByHash:o.uniqueByHash,setUniqueByHash:o.setUniqueByHash,randomFromTag:o.randomFromTag,setRandomFromTag:o.setRandomFromTag,tags:o.tags,bookmarks:o.bookmarks,getTagName:o.getTagName}),(0,t.jsxs)("div",{className:"flex gap-2 sm:gap-3 justify-center flex-wrap mt-4",children:[(0,t.jsx)("button",{type:"button",onClick:o.handleNewProblem,className:"px-4 sm:px-5 lg:px-6 py-3 bg-green-600 hover:bg-green-700 active:bg-green-800 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",children:"manual"===o.inputMode?e.problemGenerator.findSolution:e.problemGenerator.newProblem}),(0,t.jsxs)("button",{type:"button",onClick:o.handleCopyUrl,disabled:0===o.solution.length,className:"px-4 sm:px-5 lg:px-6 py-3 bg-orange-600 hover:bg-orange-700 active:bg-orange-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",title:e.bookmark.urlCopied.replace("!",""),children:["ðŸ“‹ ",e.common.share]}),(0,t.jsx)("button",{type:"button",onClick:o.handleSaveBookmark,disabled:0===o.solution.length,className:"px-4 sm:px-5 lg:px-6 py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",title:e.bookmark.title,children:e.bookmark.save}),(0,t.jsx)("button",{type:"button",onClick:()=>o.setShowBookmarkSidebar(!0),className:"px-4 sm:px-5 lg:px-6 py-3 bg-purple-600 hover:bg-purple-700 active:bg-purple-800 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",title:e.bookmark.title,children:o.bookmarks.length>0?e.bookmark.listWithCount.replace("{count}",o.bookmarks.length.toString()):e.bookmark.list})]})]})]})}function Q(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen bg-zinc-900 flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-white text-xl",children:"Loading..."})}),children:(0,t.jsx)(K,{})})}e.s(["default",()=>Q],31713)}]);