(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,85440,(e,t,a)=>{t.exports=e.r(1893)},31713,e=>{"use strict";var t=e.i(63634),a=e.i(63410),l=e.i(2942);function r(){let{locale:e,setLocale:a}=(0,l.useI18n)();return(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("button",{type:"button",onClick:()=>a("ja"),className:`px-3 py-1.5 rounded transition-colors text-sm font-bold ${"ja"===e?"bg-blue-600 text-white":"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}`,children:"æ—¥æœ¬èªž"}),(0,t.jsx)("button",{type:"button",onClick:()=>a("en"),className:`px-3 py-1.5 rounded transition-colors text-sm font-bold ${"en"===e?"bg-blue-600 text-white":"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}`,children:"English"})]})}var s=e.i(85440);let o={I:1,O:2,T:3,S:4,Z:5,J:6,L:7},n={0:null,1:"I",2:"O",3:"T",4:"S",5:"Z",6:"J",7:"L"},i={I:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]],O:[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]],T:[[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]],S:[[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]],Z:[[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]],J:[[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,0,0,0],[1,1,1,0],[0,0,0,0]],[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]]],L:[[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]]]},c={I:i.I[0],O:i.O[0],T:i.T[0],S:i.S[0],Z:i.Z[0],J:i.J[0],L:i.L[0]};function d(e,t){return"O"===e?0:"I"===e||"S"===e||"Z"===e?t%2:t}function m(e){return"empty"===e?0:o[e]}function u(e){return 0===e?"empty":n[e]||"empty"}let x=["I","O","T","S","Z","J","L"],g={I:0,O:1,T:2,S:3,Z:4,J:5,L:6},p=["I","O","T","S","Z","J","L"];function h(e){return{verticalSplitGroups:e>>13&7,complexPlacements:e>>10&7,sonicDropReachable:(2&e)!=0,singleDropReachable:(1&e)!=0}}function b(e){let t=e.map(e=>g[e]);return 2401*t[0]+343*t[1]+49*t[2]+7*t[3]+t[4]}class f{buffer=null;indexTable=null;dataRegion=null;async load(e="/precomputed-patterns.pcdb"){let t;if("undefined"!=typeof Deno&&Deno.readFile){let a=e;if(e.startsWith("/")){let t=e.replace(/^\/k-trainer/,"");a=`./public${t}`}t=(await Deno.readFile(a)).buffer}else{let a="/k-trainer",l=e;e.startsWith(a)||(l=`${a}${e}`);let r=await fetch(l);if(!r.ok)throw Error(`Failed to load database: ${r.statusText}`);t=await r.arrayBuffer()}this.buffer=t;let a=new Uint8Array(this.buffer);if("PCDB"!==String.fromCharCode(a[0],a[1],a[2],a[3]))throw Error("Invalid database format");let l=new DataView(this.buffer,0,256);l.getUint32(4,!0);let r=l.getUint32(12,!0),s=l.getUint32(16,!0);this.indexTable=new DataView(this.buffer,r,134456),this.dataRegion=new DataView(this.buffer,s)}getSolutions(e,t={}){if(!this.indexTable||!this.dataRegion)throw Error("Database not loaded");let{dropMode:a="single",checkReachability:l=!0,sortByQuality:r=!0}=t,s=8*b(e),o=this.indexTable.getUint32(s,!0);if(0===this.indexTable.getUint32(s+4,!0))return null;let n=o,i=this.dataRegion.getUint16(n,!0);n+=2;let c=[];for(let t=0;t<i;t++){let t=h(this.dataRegion.getUint32(n,!0));n+=4;let r=[];for(let e=0;e<5;e++){let e=this.dataRegion.getUint16(n,!0);r.push(function(e){let t=e>>7&15;return t>=8&&(t-=16),{type:p[e>>13&7],rotation:e>>11&3,x:t,y:e>>3&15}}(e)),n+=2}let s=!0;l&&(s="single"===a?t.singleDropReachable:t.sonicDropReachable),s&&c.push({placements:r,sequence:e,quality:t})}return 0===c.length?null:(r&&c.sort((e,t)=>t.quality.verticalSplitGroups!==e.quality.verticalSplitGroups?t.quality.verticalSplitGroups-e.quality.verticalSplitGroups:e.quality.complexPlacements-t.quality.complexPlacements),c)}getSolutionCount(e,t={}){if(!this.indexTable||!this.dataRegion)throw Error("Database not loaded");let{dropMode:a="single",checkReachability:l=!0}=t,r=8*b(e),s=this.indexTable.getUint32(r,!0);if(0===this.indexTable.getUint32(r+4,!0))return 0;let o=s,n=this.dataRegion.getUint16(o,!0);o+=2;let i=0;for(let e=0;e<n;e++){let e=h(this.dataRegion.getUint32(o,!0));o+=14;let t=!0;l&&(t="single"===a?e.singleDropReachable:e.sonicDropReachable),t&&i++}return i}hasSolution(e,t={}){return this.getSolutionCount(e,t)>0}}let k=null;async function y(e){k=new f,await k.load(e)}function v(e,t={}){if(!k)throw console.error("Database not loaded"),Error("Database not loaded");return k.getSolutions(e,t)}let j=null,N=!1;async function w(){if(!N||!j)try{if(j=await e.A(54778),"function"!=typeof j.find_perfect_clear_solutions)throw Error("WASM module is not properly initialized");N=!0}catch(e){throw console.error("[WASM INIT] Failed to initialize WASM:",e),e}}function S(e){return({I:0,O:1,T:2,S:3,Z:4,J:5,L:6})[e]}async function z(e,t={}){let{maxSolutions:a=1/0,checkReachability:l="staged",dropMode:r="sonic"}=t;if(N&&j||await w(),!j)throw Error("WASM module is not initialized");if(5!==e.length)throw Error(`Solver requires exactly 5 minos, got ${e.length}`);let s=new Uint8Array(e.map(S)),o=Number.isFinite(a)?Math.max(1,Math.floor(a)):0xffffffff,n=j.find_perfect_clear_solutions(s,o,+(!1!==l),+("single"!==r));return{solutions:n.solutions,stats:n.stats}}function T(e){return{type:e.mino_type,rotation:e.rotation,x:e.x,y:e.y}}async function C(e,t={}){let a,{initialHold:l=null,maxSolutions:r=1/0,checkReachability:s="staged",dropMode:o="sonic",includeStats:n=!1,useDatabase:i=!1}=t;if(null!==l&&5===e.length){let t=function(e,t){let a=[],l=new Set;for(let r=0;r<32;r++){let s=[],o=[],n=e,i=0;for(let e=0;e<5&&((r&1<<e)!=0&&null!==n?(s.push(n),o.push(!0),n=t[i]):(s.push(t[i]),o.push(!1)),!(++i>5));e++);if(5===s.length){let e=s.join(",");l.has(e)||(l.add(e),a.push({sequence:s,holdFlags:o}))}}return a}(l,e),a=[],u={totalNodes:0,solutionsFound:0,maxDepth:0};for(let n of t){if(a.length>=r)break;let t=r-a.length,x=[];if(i){let e=v(n.sequence,{dropMode:o,sortByQuality:!0});e&&e.length>0&&(x=e.slice(0,t),u.totalNodes+=0,u.maxDepth=Math.max(u.maxDepth,5))}else{let{solutions:e,stats:a}=await z(n.sequence,{maxSolutions:t,checkReachability:s,dropMode:o});u.totalNodes+=a.total_nodes,u.maxDepth=Math.max(u.maxDepth,a.max_depth_reached),x=e.map(e=>({placements:e.placements.map(T),sequence:n.sequence,initialHold:null}))}for(let t of x){var c,d,m;if(a.length>=r)break;let s=(c=t,d=e,m=l,{...c,placements:c.placements,initialHold:m,originalSequence:[...d]});a.push(s)}}return(u.solutionsFound=a.length,await I(a),n)?{solutions:a,stats:u}:a}if(i){let t=v(e,{dropMode:o,sortByQuality:!0});if(t&&t.length>0){if(a=t.slice(0,r),n){let e={totalNodes:0,solutionsFound:a.length,maxDepth:5};return{solutions:a,stats:e}}return a}return(a=[],n)?{solutions:a,stats:{totalNodes:0,solutionsFound:0,maxDepth:0}}:a}let{solutions:u,stats:x}=await z(e,{maxSolutions:r,checkReachability:s,dropMode:o});return(a=u.map(t=>({placements:t.placements.map(T),sequence:e,initialHold:null})),await I(a),n)?{solutions:a,stats:{totalNodes:x.total_nodes,solutionsFound:x.solutions_found,maxDepth:x.max_depth_reached}}:a}async function D(e){if(N&&j||await w(),!j)throw Error("WASM module is not initialized");let t={placements:e.placements.map(e=>({mino_type:e.type,x:e.x,y:e.y,rotation:e.rotation})),sequence:e.sequence},a=j.evaluate_solution_quality_wasm(t);return{verticalSplitGroups:a.vertical_split_groups,complexPlacements:a.needs_complex_placement,sonicDropReachable:a.sonic_drop_reachable,singleDropReachable:a.single_drop_reachable}}async function I(e){N&&j||await w();let t=await Promise.all(e.map(e=>D(e))),a=e.map(e=>(function(e){if(!e.sequence||0===e.sequence.length)return null;let t=e.initialHold;if(null==t)return null;let a=t,l=0,r=e.originalSequence||e.sequence;for(let t of e.placements){let e=t.type,s=r[l];if(e===a)a=s,l++;else{if(e!==s)return null;l++}}return a})(e)).map(e=>(function(e){if(null===e)return -1;switch(e){case"T":return 5;case"J":case"L":return 4;case"I":return 3;case"O":return 2;case"S":case"Z":return 1;default:return 0}})(e)),l=e.map((e,t)=>t);l.sort((e,l)=>{let r=t[e],s=t[l],o=a[e],n=a[l];return(o>=0||n>=0)&&n!==o?n-o:s.verticalSplitGroups!==r.verticalSplitGroups?s.verticalSplitGroups-r.verticalSplitGroups:r.complexPlacements-s.complexPlacements});let r=l.map(t=>e[t]);e.splice(0,e.length,...r)}let B="k-trainer-bookmarks",F="k-trainer-tags",R="k-trainer-bookmarks-backup",$="k-trainer-tags-backup";function M(e){let t=e.version||1;if(2===t)return e;if(1===t)return{...e,solution:e.solution.map(e=>({...e,y:e.y-5})),version:2};return console.warn(`Unknown bookmark version: ${t}`),e}let P=e=>{let t=["I","O","T","S","Z","J","L"];return e.toUpperCase().replace(/[^IOTSZJL]/g,"").split("").filter(e=>t.includes(e))},O={I:"bg-red-500",O:"bg-yellow-500",T:"bg-cyan-500",S:"bg-pink-500",Z:"bg-green-500",J:"bg-blue-500",L:"bg-orange-500",empty:"bg-zinc-800"},J=({type:e,size:a="normal"})=>{let l,r,s,o,n=c[e],i="small"===a?"w-3 h-3":"w-5 h-5",d=(l=4,r=-1,s=4,o=-1,n.forEach((e,t)=>{e.forEach((e,a)=>{e&&(l=Math.min(l,t),r=Math.max(r,t),s=Math.min(s,a),o=Math.max(o,a))})}),{minRow:l,maxRow:r,minCol:s,maxCol:o}),m=n.slice(d.minRow,d.maxRow+1).map(e=>e.slice(d.minCol,d.maxCol+1)),u=m[0].length;return(0,t.jsx)("div",{className:"grid gap-0.5",style:{gridTemplateColumns:`repeat(${u}, minmax(0, 1fr))`},children:m.flat().map((a,l)=>(0,t.jsx)("div",{className:`${i} ${a?O[e]:"bg-transparent"} ${a?"border border-black/20":""}`},l))})};function U({board:e}){return(0,t.jsx)("div",{className:"bg-black p-1 sm:p-2 rounded-lg border-2 sm:border-4 border-zinc-700",children:(0,t.jsx)("div",{className:"grid grid-rows-10 gap-0.5",children:e.map((e,a)=>(0,t.jsx)("div",{className:"flex gap-0.5",children:e.map((e,a)=>(0,t.jsx)("div",{className:`w-6 h-6 sm:w-10 sm:h-10 lg:w-12 lg:h-12 ${O[e]} ${"empty"===e?"border border-zinc-700":"border border-black"}`},a))},a))})})}function q({holdPiece:e}){let{t:a}=(0,l.useI18n)();return(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-2 sm:p-3 lg:p-4 rounded-lg border-2 border-zinc-700 w-20 sm:w-24 lg:w-28",children:[(0,t.jsx)("h2",{className:"text-white text-xs sm:text-sm font-bold mb-2 sm:mb-3 text-center",children:a.game.hold}),(0,t.jsx)("div",{className:"h-14 sm:h-16 lg:h-20 flex items-center justify-center",children:e?(0,t.jsx)(J,{type:e,size:"small"}):(0,t.jsx)("div",{className:"text-zinc-500 text-xs sm:text-sm text-center",children:"-"})})]})})}function L({nextMinos:e}){let{t:a}=(0,l.useI18n)();return(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-2 sm:p-3 lg:p-4 rounded-lg border-2 border-zinc-700 w-20 sm:w-24 lg:w-28",children:[(0,t.jsx)("h2",{className:"text-white text-xs sm:text-sm font-bold mb-2 sm:mb-3 text-center",children:a.game.nextLabel}),(0,t.jsx)("div",{className:"flex flex-col gap-1 sm:gap-1.5 lg:gap-2",children:[0,1,2,3,4].map(a=>(0,t.jsx)("div",{className:"h-12 sm:h-14 lg:h-16 flex items-center justify-center",children:e[a]?(0,t.jsx)(J,{type:e[a],size:"small"}):(0,t.jsx)("div",{className:"text-zinc-500 text-xs text-center",children:"-"})},a))})]})})}function A({onPrevStep:e,onNextStep:a,onReset:r,currentStep:s,solutionLength:o}){let{t:n}=(0,l.useI18n)();return(0,t.jsxs)("div",{className:"flex gap-2 sm:gap-3 lg:gap-4 items-stretch sm:items-center justify-center mb-3 sm:mb-4",children:[(0,t.jsx)("button",{type:"button",onClick:e,disabled:0===s,className:"flex-1 sm:flex-none px-4 sm:px-5 lg:px-6 py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",children:n.game.prev}),(0,t.jsx)("button",{type:"button",onClick:r,disabled:0===s,className:"px-3 sm:px-4 py-3 bg-zinc-700 hover:bg-zinc-600 active:bg-zinc-500 disabled:bg-zinc-800 disabled:text-zinc-600 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",children:n.common.reset}),(0,t.jsx)("button",{type:"button",onClick:a,disabled:s>=o,className:"flex-1 sm:flex-none px-4 sm:px-5 lg:px-6 py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",children:n.game.next})]})}function E({onPrevSolution:e,onNextSolution:a,currentSolutionIndex:r,allSolutionsLength:s}){let{t:o}=(0,l.useI18n)();return(0,t.jsx)("div",{className:"bg-zinc-800 p-3 rounded-lg border-2 border-zinc-700 mb-3 sm:mb-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:e,disabled:0===r||0===s,className:"px-3 py-2 bg-purple-600 hover:bg-purple-700 active:bg-purple-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm",children:o.game.prevSolution}),(0,t.jsx)("span",{className:"text-white text-sm font-bold",children:s>0?(0,t.jsxs)(t.Fragment,{children:[o.game.solution," ",r+1," / ",s]}):(0,t.jsxs)(t.Fragment,{children:[o.game.solution," 0 / 0"]})}),(0,t.jsx)("button",{type:"button",onClick:a,disabled:r>=s-1||0===s,className:"px-3 py-2 bg-purple-600 hover:bg-purple-700 active:bg-purple-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm",children:o.game.nextSolution})]})})}function G(e){let{t:a}=(0,l.useI18n)(),{inputMode:r,setInputMode:s,difficulty:o,setDifficulty:n,inputHold:i,setInputHold:c,inputNext:d,setInputNext:m,useDatabase:u,setUseDatabase:x,dropMode:g,setDropMode:p,checkReachability:h,setCheckReachability:b,randomFromTag:f,setRandomFromTag:k,tags:y,bookmarks:v,getTagName:j}=e;return(0,t.jsxs)("details",{className:"bg-zinc-800 p-3 sm:p-4 lg:p-5 rounded-lg border-2 border-zinc-700 mb-3 sm:mb-4",children:[(0,t.jsx)("summary",{className:"text-white text-sm sm:text-base font-bold cursor-pointer hover:text-zinc-300 transition-colors select-none",children:a.options.title}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:gap-4 mt-3 sm:mt-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.problemGenerator.generationMode,":"]}),(0,t.jsx)("div",{className:"flex gap-3 sm:gap-4",children:["random","bookmark","manual"].map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:e,checked:r===e,onChange:e=>s(e.currentTarget.value),className:"w-4 h-4"}),(0,t.jsx)("span",{className:"text-white text-sm sm:text-base",children:a.problemGenerator[e]})]},e))})]}),"bookmark"===r&&(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsx)("div",{className:"text-white text-sm font-bold mb-2",children:a.problemGenerator.randomFromTag}),(0,t.jsx)("select",{value:f,onChange:e=>k(e.currentTarget.value),className:"w-full px-3 py-2 bg-zinc-700 text-white rounded border border-zinc-600 focus:border-blue-500 focus:outline-none text-sm sm:text-base",children:y.map(e=>(0,t.jsxs)("option",{value:e.id,children:[j(e)," (","default-all"===e.id?v.length:v.filter(t=>t.tags.includes(e.id)).length,")"]},e.id))})]}),"random"===r&&(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.problemGenerator.difficulty,":"]}),(0,t.jsx)("div",{className:"flex gap-3 sm:gap-4",children:["easy","hard"].map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:e,checked:o===e,onChange:e=>n(e.currentTarget.value),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm sm:text-base",children:[a.problemGenerator[e],(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.problemGenerator["easy"===e?"excludeSZ":"all7Types"]})]})]},e))})]}),"manual"===r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"text-white text-xs sm:text-sm mb-1 block",children:a.problemGenerator.holdInput}),(0,t.jsx)("input",{type:"text",value:i,onChange:e=>c(e.currentTarget.value),placeholder:a.problemGenerator.holdPlaceholder,className:"w-full px-3 py-2 bg-zinc-700 text-white rounded border border-zinc-600 focus:border-blue-500 focus:outline-none text-sm sm:text-base uppercase",maxLength:1})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"text-white text-xs sm:text-sm mb-1 block",children:a.problemGenerator.nextInput}),(0,t.jsx)("input",{type:"text",value:d,onChange:e=>m(e.currentTarget.value),placeholder:a.problemGenerator.nextPlaceholder,className:"w-full px-3 py-2 bg-zinc-700 text-white rounded border border-zinc-600 focus:border-blue-500 focus:outline-none text-sm sm:text-base uppercase font-mono",maxLength:10})]})]}),(0,t.jsx)("div",{className:"text-zinc-400 text-xs",children:a.problemGenerator.validMinos})]}),(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.options.solutionMethod,":"]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:"database",checked:u,onChange:()=>x(!0),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-sm text-white",children:[a.options.database,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.databaseFast})]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:"solver",checked:!u,onChange:()=>x(!1),className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.solver,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.solverHold})]})]})]})]}),(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.options.dropMode,":"]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[(0,t.jsxs)("label",{className:`flex items-center gap-2 ${"staged"===h?"cursor-pointer":"cursor-not-allowed opacity-50"}`,children:[(0,t.jsx)("input",{type:"radio",value:"sonic",checked:"sonic"===g,onChange:()=>p("sonic"),className:"w-4 h-4",disabled:"staged"!==h}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.sonicDrop,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.sonicFast})]})]}),(0,t.jsxs)("label",{className:`flex items-center gap-2 ${"staged"===h?"cursor-pointer":"cursor-not-allowed opacity-50"}`,children:[(0,t.jsx)("input",{type:"radio",value:"single",checked:"single"===g,onChange:()=>p("single"),className:"w-4 h-4",disabled:"staged"!==h}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.singleMove,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.singleDebug})]})]})]})]}),(0,t.jsxs)("div",{className:"border-t border-zinc-700 pt-3",children:[(0,t.jsxs)("div",{className:"text-white text-sm font-bold mb-2",children:[a.options.additionalSettings,":"]}),(0,t.jsx)("div",{className:"flex flex-col gap-4 pl-2",children:(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:!1===h,onChange:e=>{b(!e.currentTarget.checked&&"staged")},className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-white text-sm",children:[a.options.disableReachabilityCheck,(0,t.jsx)("span",{className:"text-zinc-400 text-xs ml-2",children:a.options.includesInvalid})]})]})})]})]})]})}function _(e){let{t:r}=(0,l.useI18n)(),{show:s,onClose:o,bookmarks:n,tags:i,onLoadBookmark:c,getTagName:d,getTagColorClass:m,selectedFilterTag:u,setSelectedFilterTag:x,clearBookmarks:g,deleteBookmark:p,addTag:h,renameTag:b,deleteTag:f,addTagToBookmark:k,removeTagFromBookmark:y,exportBookmarks:v,importBookmarks:j,restoreFromBackup:N,getBackupInfo:w,clearBackup:S}=e,[z,T]=(0,a.useState)(!1),[C,D]=(0,a.useState)(null),[I,B]=(0,a.useState)({exists:!1});return(0,a.useState)(()=>{B(w())}),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:`fixed top-0 right-0 h-full bg-zinc-800 border-l-2 border-zinc-700 transition-transform duration-300 z-40 ${s?"translate-x-0":"translate-x-full"} w-80 sm:w-96 overflow-y-auto`,children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4 sticky top-0 bg-zinc-800 pb-2 border-b border-zinc-700",children:[(0,t.jsx)("h3",{className:"text-white text-lg font-bold",children:r.bookmark.title}),(0,t.jsx)("button",{type:"button",onClick:o,className:"px-3 py-1.5 bg-zinc-600 hover:bg-zinc-700 text-white text-sm rounded transition-colors",children:r.bookmark.close})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("div",{className:"text-white text-sm font-bold mb-2",children:r.bookmark.filterByTag}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:i.map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>x(e.id),className:`px-2 py-1 rounded text-xs transition-all ${u===e.id?`${m(e.color)} text-white font-bold`:"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}`,children:[d(e),(0,t.jsxs)("span",{className:"ml-1 text-xs",children:["(","default-all"===e.id?n.length:n.filter(t=>t.tags.includes(e.id)).length,")"]})]},e.id))})]}),(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("button",{type:"button",onClick:()=>T(!z),className:"w-full px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded transition-colors",children:z?r.bookmark.closeTagManagement:r.bookmark.tagManagement})}),(0,t.jsxs)("div",{className:"mb-3 flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{try{let e=v(),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`konoha-trainer-bookmarks-${new Date().toISOString().slice(0,10)}.json`,l.click(),URL.revokeObjectURL(a)}catch(e){alert(`Export failed: ${e}`)}},className:"flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-sm rounded transition-colors",children:"ðŸ“¥ Export"}),(0,t.jsx)("button",{type:"button",onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="application/json",e.onchange=async e=>{let t=e.target.files?.[0];if(t)try{let e=await t.text(),a=j(e);if(a.success){let e=`Successfully imported ${a.imported} bookmarks`;a.migrated&&(e+=`
(${a.migrated} bookmarks were migrated from old version)`),alert(e)}else alert(`Import failed: ${a.error}`)}catch(e){alert(`Import failed: ${e}`)}},e.click()},className:"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded transition-colors",children:"ðŸ“¤ Import"})]}),I.exists&&(0,t.jsxs)("div",{className:"mb-3 p-3 bg-yellow-900/30 border border-yellow-700 rounded-lg",children:[(0,t.jsx)("div",{className:"text-yellow-300 text-xs font-bold mb-2",children:"ðŸ”„ Backup Available"}),(0,t.jsxs)("div",{className:"text-yellow-200 text-xs mb-2",children:[I.count," bookmarks (v",I.originalVersion,")",(0,t.jsx)("br",{}),I.backedUpAt&&(0,t.jsx)("span",{className:"text-yellow-400",children:new Date(I.backedUpAt).toLocaleString("ja-JP")})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{if(!confirm("Restore bookmarks from backup? This will replace your current bookmarks."))return;let e=N();e.success?(alert(`Successfully restored ${e.restored} bookmarks from backup`),B(w())):alert(`Restore failed: ${e.error}`)},className:"flex-1 px-2 py-1 bg-yellow-600 hover:bg-yellow-700 text-white text-xs rounded transition-colors",children:"Restore"}),(0,t.jsx)("button",{type:"button",onClick:()=>{confirm("Delete backup? This cannot be undone.")&&(S()?(B({exists:!1}),alert("Backup deleted successfully")):alert("Failed to delete backup"))},className:"flex-1 px-2 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition-colors",children:"Delete"})]})]}),z&&(0,t.jsxs)("div",{className:"mb-4 p-3 bg-zinc-700 rounded-lg border border-zinc-600",children:[(0,t.jsx)("div",{className:"text-white text-sm font-bold mb-3",children:r.bookmark.manageTagsTitle}),(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("button",{type:"button",onClick:()=>{let e=prompt(r.bookmark.enterTagName);if(e?.trim()){let t=["red","orange","yellow","green","blue","purple","pink"];h(e.trim(),t[Math.floor(Math.random()*t.length)])}},className:"w-full px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-xs rounded transition-colors",children:r.bookmark.addNewTag})}),(0,t.jsxs)("div",{className:"space-y-2",children:[i.filter(e=>!e.isDefault).map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-zinc-800 rounded",children:[(0,t.jsx)("span",{className:`flex-1 px-2 py-1 rounded text-xs ${m(e.color)} text-white`,children:d(e)}),(0,t.jsx)("button",{type:"button",onClick:()=>{let t=prompt(r.bookmark.enterNewName,e.name);t?.trim()&&b(e.id,t.trim())},className:"px-2 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded transition-colors",title:r.bookmark.rename,children:"âœŽ"}),(0,t.jsx)("button",{type:"button",onClick:()=>{confirm(r.bookmark.confirmDeleteTag.replace("{name}",e.name))&&f(e.id)},className:"px-2 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition-colors",title:r.common.delete,children:"âœ•"})]},e.id)),0===i.filter(e=>!e.isDefault).length&&(0,t.jsx)("div",{className:"text-zinc-500 text-xs text-center py-2",children:r.bookmark.noCustomTags})]})]}),0===n.length?(0,t.jsx)("div",{className:"text-zinc-500 text-center py-12 text-sm",children:"default-all"===u?r.bookmark.empty:r.bookmark.emptyFiltered}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mb-3 flex justify-end",children:(0,t.jsx)("button",{type:"button",onClick:()=>{confirm(r.bookmark.confirmDeleteAll)&&g()},className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition-colors",children:r.bookmark.deleteAll})}),(0,t.jsx)("div",{className:"space-y-2",children:n.map(e=>(0,t.jsx)("div",{className:"bg-zinc-700 p-3 rounded-lg border border-zinc-600 hover:border-zinc-500 transition-colors",children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"text-white font-bold text-sm break-words",children:e.name}),(0,t.jsxs)("div",{className:"text-zinc-400 text-xs font-mono",children:[e.holdPiece&&`[${e.holdPiece}] `,e.sequence.join("")]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("div",{className:"text-zinc-500 text-xs",children:new Date(e.createdAt).toLocaleString("ja-JP")}),e.version&&(0,t.jsxs)("div",{className:"text-zinc-600 text-xs font-mono",children:["v",e.version]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-1 items-center",children:[e.tags.map(a=>{let l=i.find(e=>e.id===a);return l?(0,t.jsxs)("span",{className:`px-2 py-0.5 rounded text-xs ${m(l.color)} text-white flex items-center gap-1`,children:[d(l),(0,t.jsx)("button",{type:"button",onClick:t=>{t.stopPropagation(),y(e.id,a)},className:"hover:text-red-300",title:r.bookmark.removeTag,children:"âœ•"})]},a):null}),(0,t.jsx)("button",{type:"button",onClick:()=>D(C===e.id?null:e.id),className:"px-2 py-0.5 bg-zinc-600 hover:bg-zinc-500 text-white text-xs rounded transition-colors",title:r.bookmark.addTagTooltip,children:"ï¼‹"})]}),C===e.id&&(0,t.jsxs)("div",{className:"p-2 bg-zinc-800 rounded border border-zinc-600",children:[(0,t.jsxs)("div",{className:"text-white text-xs mb-2",children:[r.bookmark.addTag,":"]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[i.filter(t=>!t.isDefault&&!e.tags.includes(t.id)).map(a=>(0,t.jsx)("button",{type:"button",onClick:()=>{k(e.id,a.id),D(null)},className:`px-2 py-1 rounded text-xs ${m(a.color)} text-white hover:opacity-80 transition-opacity`,children:d(a)},a.id)),0===i.filter(t=>!t.isDefault&&!e.tags.includes(t.id)).length&&(0,t.jsx)("div",{className:"text-zinc-500 text-xs",children:r.bookmark.noTagsToAdd})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,t.jsx)("button",{type:"button",onClick:()=>c(e),className:"flex-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded transition-colors",children:r.bookmark.load}),(0,t.jsx)("button",{type:"button",onClick:()=>{confirm(r.bookmark.confirmDelete.replace("{name}",e.name))&&p(e.id)},className:"px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-sm rounded transition-colors",children:r.common.delete})]})]})},e.id))})]})]})}),s&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-30",onClick:o})]})}function Z(e){let{t:a}=(0,l.useI18n)(),{show:r,onClose:s,onConfirm:o,tags:n,selectedTags:i,onToggleTag:c,getTagName:d,getTagColorClass:m}=e;return r?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-6 rounded-lg border-2 border-zinc-700 max-w-md w-full",children:[(0,t.jsx)("h3",{className:"text-white text-lg font-bold mb-4",children:a.bookmark.selectTags}),(0,t.jsxs)("div",{className:"mb-4 max-h-60 overflow-y-auto",children:[n.filter(e=>!e.isDefault).map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-2 p-2 hover:bg-zinc-700 rounded cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:i.includes(e.id),onChange:()=>c(e.id),className:"w-4 h-4"}),(0,t.jsx)("span",{className:`px-2 py-1 rounded text-xs ${m(e.color)} text-white`,children:d(e)})]},e.id)),0===n.filter(e=>!e.isDefault).length&&(0,t.jsx)("div",{className:"text-zinc-500 text-sm text-center py-4",children:a.bookmark.noTags})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:a.common.save}),(0,t.jsx)("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2 bg-zinc-600 hover:bg-zinc-700 text-white rounded transition-colors",children:a.common.cancel})]})]})}):null}function H({show:e,message:a}){let{t:r}=(0,l.useI18n)();return e?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-6 sm:p-8 rounded-lg border-2 border-zinc-700 text-center max-w-md mx-4",children:[(0,t.jsx)("div",{className:"text-white text-lg sm:text-xl mb-4",children:a||r.common.initializing}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})})]})}):null}function W({error:e,onClose:a}){let{t:r}=(0,l.useI18n)();return e?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-zinc-800 p-6 sm:p-8 rounded-lg border-2 border-zinc-700 text-center max-w-md mx-4",children:[(0,t.jsx)("div",{className:"text-red-500 text-lg sm:text-xl mb-4",children:e}),(0,t.jsx)("button",{type:"button",onClick:a,className:"px-6 py-3 bg-zinc-600 hover:bg-zinc-700 text-white rounded-lg font-bold transition-colors",children:r.common.close})]})}):null}function V(){let{t:e}=(0,l.useI18n)(),o=function(){var e,t;let r,o=(0,s.useSearchParams)(),n=(0,s.useRouter)(),{t:g}=(0,l.useI18n)(),[p,h]=(0,a.useState)([]),[b,f]=(0,a.useState)(null),[k,j]=(0,a.useState)([]),[N,S]=(0,a.useState)(0),[z,T]=(0,a.useState)([]),[D,I]=(0,a.useState)(0),[O,J]=(0,a.useState)(!1),[U,q]=(0,a.useState)(""),[L,A]=(0,a.useState)(""),[E,G]=(0,a.useState)(!1),[_,Z]=(0,a.useState)(!1),[H,W]=(0,a.useState)("random"),[V,Q]=(0,a.useState)(""),[K,X]=(0,a.useState)(""),[Y,ee]=(0,a.useState)("hard"),[et,ea]=(0,a.useState)(!0),[el,er]=(0,a.useState)("staged"),[es,eo]=(0,a.useState)("sonic"),en=function(){let{t:e}=(0,l.useI18n)(),t=[{id:"default-all",name:e.common.all,color:"gray",isDefault:!0}],[r,s]=(0,a.useState)([]),[o,n]=(0,a.useState)(t);(0,a.useEffect)(()=>{try{let e=localStorage.getItem(B);if(e){let t=JSON.parse(e),a=t.some(e=>2!==(e.version||1));if(a)try{let e={bookmarks:t,backedUpAt:Date.now(),originalVersion:t[0]?.version||1};localStorage.setItem(R,JSON.stringify(e)),console.log(`Backed up ${t.length} bookmarks before migration`);let a=localStorage.getItem(F);a&&localStorage.setItem($,a)}catch(e){console.error("Failed to backup bookmarks:",e)}let l=t.map(e=>{let t={...e,tags:e.tags||[]};return M(t)});s(l),a&&(localStorage.setItem(B,JSON.stringify(l)),console.log(`Migrated ${l.length} bookmarks to version 2`))}let a=localStorage.getItem(F);if(a){let e=JSON.parse(a).filter(e=>!e.isDefault);n([...t,...e])}}catch(e){console.error("Failed to load bookmarks:",e)}},[]);let i=e=>{try{localStorage.setItem(B,JSON.stringify(e)),s(e)}catch(e){console.error("Failed to save bookmarks:",e)}},c=e=>{try{let t=e.filter(e=>!e.isDefault);localStorage.setItem(F,JSON.stringify(t)),n(e)}catch(e){console.error("Failed to save tags:",e)}};return{bookmarks:r,tags:o,addBookmark:(e,t,a,l,s=[])=>{try{let o,n=r.find(e=>{var l,r;return l=e.sequence,r=e.holdPiece,l.length===t.length&&r===a&&l.every((e,a)=>e===t[a])});if(n)o=r.map(t=>t.id===n.id?{...t,name:e,solution:l,tags:s,version:2}:t);else{let n={id:Date.now().toString(),name:e,sequence:t,holdPiece:a,solution:l,createdAt:Date.now(),tags:s,version:2};o=[...r,n]}return i(o),!0}catch(e){return console.error("Failed to add bookmark:",e),!1}},deleteBookmark:e=>{i(r.filter(t=>t.id!==e))},clearBookmarks:()=>{i([])},addTag:(e,t)=>{try{let a={id:`tag-${Date.now()}`,name:e,color:t,isDefault:!1},l=[...o,a];return c(l),!0}catch(e){return console.error("Failed to add tag:",e),!1}},deleteTag:e=>{let t=o.find(t=>t.id===e);if(t?.isDefault)return console.error("Cannot delete default tag"),!1;try{let t=o.filter(t=>t.id!==e);c(t);let a=r.map(t=>({...t,tags:t.tags.filter(t=>t!==e)}));return i(a),!0}catch(e){return console.error("Failed to delete tag:",e),!1}},renameTag:(e,t)=>{let a=o.find(t=>t.id===e);if(a?.isDefault)return console.error("Cannot rename default tag"),!1;try{let a=o.map(a=>a.id===e?{...a,name:t}:a);return c(a),!0}catch(e){return console.error("Failed to rename tag:",e),!1}},changeTagColor:(e,t)=>{let a=o.find(t=>t.id===e);if(a?.isDefault)return console.error("Cannot change default tag color"),!1;try{let a=o.map(a=>a.id===e?{...a,color:t}:a);return c(a),!0}catch(e){return console.error("Failed to change tag color:",e),!1}},addTagToBookmark:(e,t)=>{try{let a=r.map(a=>a.id!==e||a.tags.includes(t)?a:{...a,tags:[...a.tags,t]});return i(a),!0}catch(e){return console.error("Failed to add tag to bookmark:",e),!1}},removeTagFromBookmark:(e,t)=>{try{let a=r.map(a=>a.id===e?{...a,tags:a.tags.filter(e=>e!==t)}:a);return i(a),!0}catch(e){return console.error("Failed to remove tag from bookmark:",e),!1}},getRandomBookmarkByTag:e=>{let t="default-all"===e?r:r.filter(t=>t.tags.includes(e));if(0===t.length)return null;let a=Math.floor(Math.random()*t.length);return t[a]},exportBookmarks:()=>JSON.stringify({bookmarks:r,tags:o.filter(e=>!e.isDefault),exportedAt:Date.now(),version:2},null,2),importBookmarks:e=>{try{let a=JSON.parse(e);if(!a.bookmarks||!Array.isArray(a.bookmarks))return{success:!1,error:"Invalid data format: bookmarks array not found"};let l=a.bookmarks.map(e=>M(e)),s=a.bookmarks.filter(e=>2!==(e.version||1)).length;r.map(e=>e.id);let n=[...r];for(let e of l){let t=n.findIndex(t=>t.id===e.id);t>=0?n[t]=e:n.push(e)}if(i(n),a.tags&&Array.isArray(a.tags)){let e=o.filter(e=>!e.isDefault),l=new Set(e.map(e=>e.id)),r=[...e];for(let e of a.tags)l.has(e.id)||e.isDefault||r.push(e);c([...t,...r])}return{success:!0,imported:l.length,migrated:s>0?s:void 0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}},restoreFromBackup:()=>{try{let e=localStorage.getItem(R);if(!e)return{success:!1,error:"No backup found"};let a=JSON.parse(e);if(!a.bookmarks||!Array.isArray(a.bookmarks))return{success:!1,error:"Invalid backup data format"};let l=a.bookmarks.map(e=>({...e,tags:e.tags||[]}));s(l),localStorage.setItem(B,JSON.stringify(l));let r=localStorage.getItem($);if(r){let e=JSON.parse(r).filter(e=>!e.isDefault),a=[...t,...e];n(a),c(a)}return{success:!0,restored:l.length}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}},getBackupInfo:()=>{try{let e=localStorage.getItem(R);if(!e)return{exists:!1};let t=JSON.parse(e);return{exists:!0,count:t.bookmarks?.length,backedUpAt:t.backedUpAt,originalVersion:t.originalVersion}}catch(e){return{exists:!1}}},clearBackup:()=>{try{return localStorage.removeItem(R),localStorage.removeItem($),!0}catch(e){return console.error("Failed to clear backup:",e),!1}}}}(),[ei,ec]=(0,a.useState)(!1),[ed,em]=(0,a.useState)(!1),[eu,ex]=(0,a.useState)([]),[eg,ep]=(0,a.useState)("default-all"),[eh,eb]=(0,a.useState)("default-all"),[ef,ek]=(0,a.useState)(!1),[ey,ev]=(0,a.useState)(null),[ej,eN]=(0,a.useState)(!0),[ew,eS]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{q(g.common.initializing),await w(),G(!0);try{q(g.common.loadingDatabase),await y("/precomputed-patterns.pcdb"),Z(!0)}catch(e){console.warn("DB load failed, solver mode:",e),Z(!1)}finally{eS(!0)}}catch(e){A("WASMã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(e instanceof Error?e.message:String(e))),eS(!0)}})()},[g.common.initializing,g.common.loadingDatabase]);let ez=(0,a.useCallback)(async(e,t)=>{if(E){J(!0),q("å•é¡Œã‚’ç”Ÿæˆä¸­..."),A(""),await new Promise(e=>setTimeout(e,0));try{let a;if(et&&_&&!t){let t=v(e,{dropMode:es,checkReachability:!1!==el,sortByQuality:!0});if(t&&t.length>0)a=t;else{A(g.error.noSequenceInDatabase),J(!1);return}}else a=await C(e,{initialHold:t,checkReachability:el,dropMode:es,useDatabase:et&&_});if(a.length>0){let l=a.map(e=>e.placements);j(l),S(0),h(e),f(t),T(l[0]),I(0)}else A(g.error.noSolution)}catch(e){A("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+(e instanceof Error?e.message:String(e)))}finally{J(!1)}}},[E,et,_,es,el,g.error.noSequenceInDatabase,g.error.noSolution]);(0,a.useEffect)(()=>{if(!E||!ej||!ew)return;let e=o.get("hold"),t=o.get("next"),a=o.get("mode"),l=o.get("reach"),r=o.get("drop");o.get("bitboard");let s=o.get("db"),n=o.get("difficulty");if("manual"===a?W("manual"):W("random"),"easy"===n?ee("easy"):ee("hard"),"false"===s?ea(!1):ea(!0),"false"===l?er(!1):er("staged"),"single"===r?eo("single"):eo("sonic"),t){let l=P(t);5===l.length&&("manual"===a&&(X(t.toUpperCase()),e&&P(e).length<=1&&Q(e.toUpperCase())),setTimeout(()=>{ez(l,e?P(e)[0]:null)},100))}eN(!1)},[E,ej,ew,o,ez]);let eT=(0,a.useCallback)((e,t,a,l,r,s,o)=>{let i=new URLSearchParams;5===e.length&&(i.set("next",e.join("")),t&&i.set("hold",t),"manual"===a&&i.set("mode","manual")),"staged"!==l&&i.set("reach",String(l)),"sonic"!==r&&i.set("drop",r),!0!==s&&i.set("db",String(s)),"hard"!==o&&i.set("difficulty",o);let c=i.toString()?`?${i.toString()}`:"/";n.push(c,{scroll:!1})},[n]),eC=(0,a.useCallback)(async e=>{h(e.sequence),f(e.holdPiece),T(e.solution),I(0),J(!0);try{let t=[];if(!e.holdPiece&&et&&_){let a=v(e.sequence);a&&a.length>0&&(t=a)}if(0===t.length&&(t=await C(e.sequence,{initialHold:e.holdPiece,checkReachability:el,dropMode:es,useDatabase:et&&_})),t.length>0){let a=t.map(e=>e.placements);j(a);let l=a.findIndex(t=>JSON.stringify(t)===JSON.stringify(e.solution));S(-1!==l?l:0)}else j([e.solution]),S(0)}catch(t){console.error("Failed to recalculate solutions:",t),j([e.solution]),S(0)}finally{J(!1)}eT(e.sequence,e.holdPiece,H,el,es,et,Y)},[en.bookmarks,et,_,el,es,eT,H,Y]),eD=(0,a.useCallback)(async()=>{if(!E)return void A(g.error.wasmInit);J(!0),q(g.problemGenerator.generating),A(""),await new Promise(e=>setTimeout(e,0));try{if("bookmark"===H){let e=en.getRandomBookmarkByTag(eh);if(e)await eC(e);else{let e=en.tags.find(e=>e.id===eh),t=e?eM(e):g.common.all;A(g.error.noBookmarkInTag.replace("{tag}",t))}J(!1);return}let e=[],t=null,a=[];if("manual"===H){let l,r=P(V),s=P(K);if(5!==s.length){A(g.error.nextRequired.replace("{count}",String(s.length))),J(!1);return}if(r.length>1){A(g.error.holdRequired.replace("{count}",String(r.length))),J(!1);return}if(e=s,t=1===r.length?r[0]:null,et&&_&&!t){let t=v(e,{dropMode:es,checkReachability:!1!==el,sortByQuality:!0});if(t&&t.length>0)l=t;else{A(g.error.noSequenceInDatabase),J(!1);return}}else l=await C(e,{initialHold:t,checkReachability:el,dropMode:es,useDatabase:et&&_});if(l.length>0){let e=l.map(e=>e.placements);j(e),S(0),a=e[0]}else A(g.error.noSolution)}else{let l=0;for(;0===a.length&&l<10;){let r;l++,q(`${g.problemGenerator.generating} (${l}${g.problemGenerator.attempt})`),l%5==0&&await new Promise(e=>setTimeout(e,0));let{sequence:s,hold:o}=function(e="hard"){let t=function(e="hard"){let t=[..."easy"===e?["J","J","L","L"]:["Z","Z","S","S"]],a=[];for(let l=0;l<10;l++){let{mino:l,newHistory:r}=function(e,t="hard"){let a=null,l="easy"===t?x.filter(e=>"S"!==e&&"Z"!==e):x;for(let t=0;t<6;t++){let r=Math.floor(Math.random()*l.length),s=l[r];if(!e.includes(s)){a=s;break}5===t&&(a=s)}let r=[a,...e.slice(0,3)];return{mino:a,newHistory:r}}(t,e);a.push(l),t=r}return a}(e),a=t[4];return{sequence:t.slice(5,10),hold:a}}(Y);if(e=s,t=o,et&&_&&!t){let t=v(e,{dropMode:es,checkReachability:!1!==el,sortByQuality:!0});if(!t||!(t.length>0))continue;r=t}else r=await C(e,{initialHold:t,checkReachability:el,dropMode:es,useDatabase:et&&_});if(r.length>0){let e=r.map(e=>e.placements);j(e),S(0),a=e[0]}}0===a.length&&A(g.error.attempts)}a.length>0&&(h(e),f(t),T(a),I(0),eT(e,t,H,el,es,et,Y))}catch(e){A("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+(e instanceof Error?e.message:String(e)))}finally{J(!1)}},[E,g,H,en,eh,eC,V,K,et,_,es,el,Y,eT]),eI=z.length>0?(e=z.slice(0,D),r=[,,,,,].fill(null).map(()=>[,,,,,].fill("empty")),e.forEach((e,t)=>{t>0&&(r=(function(e){let t=[];for(let a=0;a<5;a++){let l=e[a];l.every(e=>0!==e)||t.push([...l])}let a=5-t.length;for(let e=0;e<a;e++)t.unshift([,,,,,].fill(0));return t})(r.map(e=>e.map(m))).map(e=>e.map(u)));let a=e.type;(function(e,t,a){if(a){let e=d(a,t);return i[a][e]}for(let a of Object.keys(c))if(JSON.stringify(c[a])===JSON.stringify(e)){let e=d(a,t);return i[a][e]}return e})(c[a],e.rotation,a).forEach((t,l)=>{t.forEach((t,s)=>{if(t){let t=e.y+l,o=e.x+s;t>=0&&t<5&&o>=0&&o<5&&(r[t][o]=a)}})})}),t=r,[...[,,,,,].fill(null).map(()=>[,,,,,].fill("empty")),...t]):Array(10).fill(null).map(()=>[,,,,,].fill("empty")),eB=(()=>{if(0===z.length||0===D)return b;if(null===b)return null;let e=b,t=0;for(let a=0;a<D;a++){let l=z[a].type,r=p[t];if(l===e)e=r,t++;else{if(l!==r)return console.warn(`Mismatch at step ${a}: placed=${l}, expected=${r}, hold=${e}`),b;t++}}return e})(),eF=p.slice(D),eR=async()=>{try{await navigator.clipboard.writeText(window.location.href),alert(g.bookmark.urlCopied)}catch(e){console.error("Failed to copy to clipboard:",e),alert(g.bookmark.urlCopyFailed)}},e$=en.bookmarks.filter(e=>"default-all"===eg||e.tags.includes(eg)),eM=e=>"default-all"===e.id?g.common.all:e.name;return{sequence:p,holdPiece:b,allSolutions:k,currentSolutionIndex:N,solution:z,currentStep:D,isLoading:O,loadingMessage:U,error:L,wasmInitialized:E,isDatabaseInitialized:ew,inputMode:H,inputHold:V,inputNext:K,difficulty:Y,useDatabase:et,checkReachability:el,dropMode:es,randomFromTag:eh,board:eI,currentHold:eB,nextMinos:eF,showBookmarkSidebar:ei,showSaveModal:ed,selectedTagsForSave:eu,selectedFilterTag:eg,showTagEditor:ef,editingBookmarkId:ey,filteredBookmarks:e$,setSequence:h,setHoldPiece:f,setAllSolutions:j,setCurrentSolutionIndex:S,setSolution:T,setCurrentStep:I,setIsLoading:J,setLoadingMessage:q,setError:A,setWasmInitialized:G,setDatabaseLoaded:Z,setInputMode:W,setInputHold:Q,setInputNext:X,setDifficulty:ee,setUseDatabase:ea,setCheckReachability:er,setDropMode:eo,setShowBookmarkSidebar:ec,setShowSaveModal:em,setSelectedTagsForSave:ex,setSelectedFilterTag:ep,setRandomFromTag:eb,setShowTagEditor:ek,setEditingBookmarkId:ev,handlePrevStep:()=>I(e=>Math.max(0,e-1)),handleNextStep:()=>I(e=>Math.min(z.length,e+1)),handleReset:()=>I(0),handlePrevSolution:()=>{if(N>0){let e=N-1;S(e),T(k[e]),I(0)}},handleNextSolution:()=>{if(N<k.length-1){let e=N+1;S(e),T(k[e]),I(0)}},handleNewProblem:()=>eD(),handleCopyUrl:eR,handleSaveBookmark:()=>{if(0===z.length)return void alert(g.bookmark.failed);let e=en.bookmarks.find(e=>JSON.stringify(e.sequence)===JSON.stringify(p)&&e.holdPiece===b);em(!0),ex(e?e.tags:[])},confirmSaveBookmark:()=>{if(0===z.length)return;let e=b?`[${b}] ${p.join("")}`:p.join(""),t=new Date().toLocaleString("ja-JP",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),a=`${e} (${t})`;en.addBookmark(a,p,b,z,eu)?(alert(g.bookmark.saved),em(!1),ex([])):alert(g.bookmark.failed)},toggleTagForSave:e=>{ex(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},handleLoadBookmark:eC,getTagName:eM,getTagColorClass:e=>({gray:"bg-gray-600",red:"bg-red-600",orange:"bg-orange-600",yellow:"bg-yellow-600",green:"bg-green-600",blue:"bg-blue-600",purple:"bg-purple-600",pink:"bg-pink-600"})[e]||"bg-gray-600",...en}}();return(0,t.jsxs)("div",{className:"min-h-screen bg-zinc-900 font-sans p-2 sm:p-4 relative flex",children:[(0,t.jsx)(H,{show:!o.wasmInitialized||!o.isDatabaseInitialized,message:o.loadingMessage||e.common.initializing}),(0,t.jsx)(W,{error:o.error,onClose:()=>o.setError("")}),(0,t.jsx)(Z,{show:o.showSaveModal,onClose:()=>{o.setShowSaveModal(!1),o.setSelectedTagsForSave([])},onConfirm:o.confirmSaveBookmark,tags:o.tags,selectedTags:o.selectedTagsForSave,onToggleTag:o.toggleTagForSave,getTagName:o.getTagName,getTagColorClass:o.getTagColorClass}),(0,t.jsx)(_,{show:o.showBookmarkSidebar,onClose:()=>o.setShowBookmarkSidebar(!1),bookmarks:o.filteredBookmarks,tags:o.tags,onLoadBookmark:o.handleLoadBookmark,getTagName:o.getTagName,getTagColorClass:o.getTagColorClass,selectedFilterTag:o.selectedFilterTag,setSelectedFilterTag:o.setSelectedFilterTag,clearBookmarks:o.clearBookmarks,deleteBookmark:o.deleteBookmark,addTag:o.addTag,renameTag:o.renameTag,deleteTag:o.deleteTag,addTagToBookmark:o.addTagToBookmark,removeTagFromBookmark:o.removeTagFromBookmark,exportBookmarks:o.exportBookmarks,importBookmarks:o.importBookmarks,restoreFromBackup:o.restoreFromBackup,getBackupInfo:o.getBackupInfo,clearBackup:o.clearBackup}),(0,t.jsxs)("div",{className:"flex-1 max-w-6xl mx-auto w-full",children:[(0,t.jsx)(H,{show:o.isLoading,message:o.loadingMessage}),(0,t.jsx)("div",{className:"flex justify-end mb-3",children:(0,t.jsx)(r,{})}),(0,t.jsxs)("div",{className:"text-center mb-3 sm:mb-4",children:[(0,t.jsx)("h1",{className:"text-white text-xl sm:text-2xl font-bold mb-1 sm:mb-2",children:e.common.appTitle}),(0,t.jsx)("div",{className:"text-zinc-400 text-xs sm:text-sm",children:o.solution.length>0?(0,t.jsxs)(t.Fragment,{children:[e.game.step,": ",o.currentStep," / ",o.solution.length,o.currentStep===o.solution.length&&(0,t.jsxs)("span",{className:"ml-2 sm:ml-4 text-green-500 font-bold",children:["âœ“ ",e.game.complete]})]}):(0,t.jsx)("span",{children:e.game.clickToStart})})]}),(0,t.jsxs)("div",{className:"flex gap-2 sm:gap-4 lg:gap-6 items-start justify-center mb-3 sm:mb-4 overflow-x-auto",children:[(0,t.jsx)(q,{holdPiece:o.currentHold}),(0,t.jsx)(U,{board:o.board}),(0,t.jsx)(L,{nextMinos:o.nextMinos})]}),(0,t.jsx)(E,{onPrevSolution:o.handlePrevSolution,onNextSolution:o.handleNextSolution,currentSolutionIndex:o.currentSolutionIndex,allSolutionsLength:o.allSolutions.length}),(0,t.jsx)(A,{onPrevStep:o.handlePrevStep,onNextStep:o.handleNextStep,onReset:o.handleReset,currentStep:o.currentStep,solutionLength:o.solution.length}),(0,t.jsx)(G,{inputMode:o.inputMode,setInputMode:o.setInputMode,difficulty:o.difficulty,setDifficulty:o.setDifficulty,inputHold:o.inputHold,setInputHold:o.setInputHold,inputNext:o.inputNext,setInputNext:o.setInputNext,useDatabase:o.useDatabase,setUseDatabase:o.setUseDatabase,dropMode:o.dropMode,setDropMode:o.setDropMode,checkReachability:o.checkReachability,setCheckReachability:o.setCheckReachability,randomFromTag:o.randomFromTag,setRandomFromTag:o.setRandomFromTag,tags:o.tags,bookmarks:o.bookmarks,getTagName:o.getTagName}),(0,t.jsxs)("div",{className:"flex gap-2 sm:gap-3 justify-center flex-wrap mt-4",children:[(0,t.jsx)("button",{type:"button",onClick:o.handleNewProblem,className:"px-4 sm:px-5 lg:px-6 py-3 bg-green-600 hover:bg-green-700 active:bg-green-800 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",children:"manual"===o.inputMode?e.problemGenerator.findSolution:e.problemGenerator.newProblem}),(0,t.jsxs)("button",{type:"button",onClick:o.handleCopyUrl,disabled:0===o.solution.length,className:"px-4 sm:px-5 lg:px-6 py-3 bg-orange-600 hover:bg-orange-700 active:bg-orange-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",title:e.bookmark.urlCopied.replace("!",""),children:["ðŸ“‹ ",e.common.share]}),(0,t.jsx)("button",{type:"button",onClick:o.handleSaveBookmark,disabled:0===o.solution.length,className:"px-4 sm:px-5 lg:px-6 py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-zinc-700 disabled:text-zinc-500 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",title:e.bookmark.title,children:e.bookmark.save}),(0,t.jsx)("button",{type:"button",onClick:()=>o.setShowBookmarkSidebar(!0),className:"px-4 sm:px-5 lg:px-6 py-3 bg-purple-600 hover:bg-purple-700 active:bg-purple-800 text-white rounded-lg font-bold transition-colors text-sm sm:text-base",title:e.bookmark.title,children:o.bookmarks.length>0?e.bookmark.listWithCount.replace("{count}",o.bookmarks.length.toString()):e.bookmark.list})]})]})]})}function Q(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen bg-zinc-900 flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-white text-xl",children:"Loading..."})}),children:(0,t.jsx)(V,{})})}e.s(["default",()=>Q],31713)}]);